<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 8.3.0" />
    <title>ovirtsdk4 API documentation</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2264%22%20height%3D%2264%22%20viewBox%3D%2244.5%202.5%2015%2015%22%3E%3Cpath%20d%3D%22M49.351%2021.041c-.233-.721-.546-2.408-.772-4.076-.042-.09-.067-.187-.046-.288-.166-1.347-.277-2.625-.241-3.351-1.378-1.008-2.271-2.586-2.271-4.362%200-.976.272-1.935.788-2.774.057-.094.122-.18.184-.268-.033-.167-.052-.339-.052-.516%200-1.477%201.202-2.679%202.679-2.679.791%200%201.496.352%201.987.9a6.3%206.3%200%200%201%201.001.029c.492-.564%201.207-.929%202.012-.929%201.477%200%202.679%201.202%202.679%202.679a2.65%202.65%200%200%201-.269%201.148c.383.747.595%201.572.595%202.41%200%202.311-1.507%204.29-3.635%205.107.037.699.147%202.27.423%203.294l.137.461c.156%202.136-4.612%205.166-5.199%203.215zm.127-4.919a4.78%204.78%200%200%200%20.775-.584c-.172-.115-.505-.254-.88-.378zm.331%202.302l.828-.502c-.202-.143-.576-.328-.984-.49zm.45%202.157l.701-.403c-.214-.115-.536-.249-.891-.376l.19.779zM49.13%204.141c0%20.152.123.276.276.276s.275-.124.275-.276-.123-.276-.276-.276-.275.124-.275.276zm.735-.389a1.15%201.15%200%200%201%20.314.783%201.16%201.16%200%200%201-1.162%201.162c-.457%200-.842-.27-1.032-.653-.026.117-.042.238-.042.362a1.68%201.68%200%200%200%201.679%201.679%201.68%201.68%200%200%200%201.679-1.679c0-.843-.626-1.535-1.436-1.654zm3.076%201.654a1.68%201.68%200%200%200%201.679%201.679%201.68%201.68%200%200%200%201.679-1.679c0-.037-.009-.072-.011-.109-.21.3-.541.508-.935.508a1.16%201.16%200%200%201-1.162-1.162%201.14%201.14%200%200%201%20.474-.912c-.015%200-.03-.005-.045-.005-.926.001-1.679.754-1.679%201.68zm1.861-1.265c0%20.152.123.276.276.276s.275-.124.275-.276-.123-.276-.276-.276-.275.124-.275.276zm1.823%204.823c0-.52-.103-1.035-.288-1.52-.466.394-1.06.64-1.717.64-1.144%200-2.116-.725-2.499-1.738-.383%201.012-1.355%201.738-2.499%201.738-.867%200-1.631-.421-2.121-1.062-.307.605-.478%201.267-.478%201.942%200%202.486%202.153%204.51%204.801%204.51s4.801-2.023%204.801-4.51zm-3.032%209.156l-.146-.492c-.276-1.02-.395-2.457-.444-3.268a6.11%206.11%200%200%201-1.18.115%206.01%206.01%200%200%201-2.536-.562l.006.175c.802.215%201.848.612%202.021%201.25.079.295-.021.601-.274.837l-.598.501c.667.304%201.243.698%201.311%201.179.02.144.022.507-.393.787l-.564.365c1.285.521%201.361.96%201.381%201.126.018.142.011.496-.427.746l-.854.489c.064-1.19%201.985-2.585%202.697-3.248zM49.34%209.925c0-.667%201-.667%201%200%200%20.653.818%201.205%201.787%201.205s1.787-.552%201.787-1.205c0-.667%201-.667%201%200%200%201.216-1.25%202.205-2.787%202.205s-2.787-.989-2.787-2.205zm-.887-7.633c-.093.077-.205.114-.317.114a.5.5%200%200%201-.318-.886L49.183.397a.5.5%200%200%201%20.703.068.5.5%200%200%201-.069.703zm7.661-.065c-.086%200-.173-.022-.253-.068l-1.523-.893c-.575-.337-.069-1.2.506-.863l1.523.892a.5.5%200%200%201%20.179.685c-.094.158-.261.247-.432.247z%22%20fill%3D%22%233bb300%22/%3E%3C/svg%3E"/>


<style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
<style>/*! pygments syntax highlighting */pre{line-height:125%;}td.linenos pre{color:#000000; background-color:#f0f0f0; padding-left:5px; padding-right:5px;}span.linenos{color:#000000; background-color:#f0f0f0; padding-left:5px; padding-right:5px;}td.linenos pre.special{color:#000000; background-color:#ffffc0; padding-left:5px; padding-right:5px;}span.linenos.special{color:#000000; background-color:#ffffc0; padding-left:5px; padding-right:5px;}.pdoc .hll{background-color:#ffffcc}.pdoc{background:#f8f8f8;}.pdoc .c{color:#408080; font-style:italic}.pdoc .err{border:1px solid #FF0000}.pdoc .k{color:#008000; font-weight:bold}.pdoc .o{color:#666666}.pdoc .ch{color:#408080; font-style:italic}.pdoc .cm{color:#408080; font-style:italic}.pdoc .cp{color:#BC7A00}.pdoc .cpf{color:#408080; font-style:italic}.pdoc .c1{color:#408080; font-style:italic}.pdoc .cs{color:#408080; font-style:italic}.pdoc .gd{color:#A00000}.pdoc .ge{font-style:italic}.pdoc .gr{color:#FF0000}.pdoc .gh{color:#000080; font-weight:bold}.pdoc .gi{color:#00A000}.pdoc .go{color:#888888}.pdoc .gp{color:#000080; font-weight:bold}.pdoc .gs{font-weight:bold}.pdoc .gu{color:#800080; font-weight:bold}.pdoc .gt{color:#0044DD}.pdoc .kc{color:#008000; font-weight:bold}.pdoc .kd{color:#008000; font-weight:bold}.pdoc .kn{color:#008000; font-weight:bold}.pdoc .kp{color:#008000}.pdoc .kr{color:#008000; font-weight:bold}.pdoc .kt{color:#B00040}.pdoc .m{color:#666666}.pdoc .s{color:#BA2121}.pdoc .na{color:#7D9029}.pdoc .nb{color:#008000}.pdoc .nc{color:#0000FF; font-weight:bold}.pdoc .no{color:#880000}.pdoc .nd{color:#AA22FF}.pdoc .ni{color:#999999; font-weight:bold}.pdoc .ne{color:#D2413A; font-weight:bold}.pdoc .nf{color:#0000FF}.pdoc .nl{color:#A0A000}.pdoc .nn{color:#0000FF; font-weight:bold}.pdoc .nt{color:#008000; font-weight:bold}.pdoc .nv{color:#19177C}.pdoc .ow{color:#AA22FF; font-weight:bold}.pdoc .w{color:#bbbbbb}.pdoc .mb{color:#666666}.pdoc .mf{color:#666666}.pdoc .mh{color:#666666}.pdoc .mi{color:#666666}.pdoc .mo{color:#666666}.pdoc .sa{color:#BA2121}.pdoc .sb{color:#BA2121}.pdoc .sc{color:#BA2121}.pdoc .dl{color:#BA2121}.pdoc .sd{color:#BA2121; font-style:italic}.pdoc .s2{color:#BA2121}.pdoc .se{color:#BB6622; font-weight:bold}.pdoc .sh{color:#BA2121}.pdoc .si{color:#BB6688; font-weight:bold}.pdoc .sx{color:#008000}.pdoc .sr{color:#BB6688}.pdoc .s1{color:#BA2121}.pdoc .ss{color:#19177C}.pdoc .bp{color:#008000}.pdoc .fm{color:#0000FF}.pdoc .vc{color:#19177C}.pdoc .vg{color:#19177C}.pdoc .vi{color:#19177C}.pdoc .vm{color:#19177C}.pdoc .il{color:#666666}</style>
<style>/*! pdoc */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f7f7f7;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}body{background-color:var(--pdoc-background);}html, body{width:100%;height:100%;}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}.git-button{display:none !important;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}#navtoggle{display:none;}}#togglestate{display:none;}nav.pdoc{--pad:1.75rem;--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc li{display:block;margin:0;padding:.2rem 0 .2rem var(--indent);transition:all 100ms;}nav.pdoc > div > ul > li{padding-left:0;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}html, main{scroll-behavior:smooth;}.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{background-color:var(--code);border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--code);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.pdoc details{filter:opacity(1);}.pdoc details:not([open]){height:0;}.pdoc details > summary{position:absolute;top:-35px;right:0;font-size:.75rem;color:var(--muted);padding:0 .7em;user-select:none;}.pdoc details > summary:focus{outline:0;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc > section:first-of-type > .docstring{margin-bottom:2.5rem;}.pdoc .docstring pre{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc .headerlink{position:absolute;width:0;margin-left:-1.5rem;line-height:1.4rem;font-size:1.5rem;font-weight:normal;transition:all 100ms ease-in-out;opacity:0;user-select:none;}.pdoc .attr > .headerlink{margin-left:-2.5rem;}.pdoc *:hover > .headerlink,.pdoc *:target > .attr > .headerlink{opacity:1;}.pdoc .attr{display:block;color:var(--text);margin:.5rem 0 .5rem;padding:.4rem 5rem .4rem 1rem;background-color:var(--accent);}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{white-space:pre-wrap;}.pdoc .annotation{color:var(--annotation);}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
</head>
<body>        <nav class="pdoc">
            <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
            <input id="togglestate" type="checkbox">
            <div>
                        <a class="pdoc-button module-list-button" href="index.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                            &nbsp;
                            Module Index
                        </a>


                        <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                               pattern=".+" required>


                    <h2>Submodules</h2>
                    <ul>
                            <li><a href="ovirtsdk4/http.html">ovirtsdk4.http</a></li>
                            <li><a href="ovirtsdk4/reader.html">ovirtsdk4.reader</a></li>
                            <li><a href="ovirtsdk4/readers.html">ovirtsdk4.readers</a></li>
                            <li><a href="ovirtsdk4/service.html">ovirtsdk4.service</a></li>
                            <li><a href="ovirtsdk4/services.html">ovirtsdk4.services</a></li>
                            <li><a href="ovirtsdk4/types.html">ovirtsdk4.types</a></li>
                            <li><a href="ovirtsdk4/version.html">ovirtsdk4.version</a></li>
                            <li><a href="ovirtsdk4/writer.html">ovirtsdk4.writer</a></li>
                            <li><a href="ovirtsdk4/writers.html">ovirtsdk4.writers</a></li>
                            <li><a href="ovirtsdk4/xml.html">ovirtsdk4.xml</a></li>
                    </ul>

                    <h2>API Documentation</h2>
                        <ul class="memberlist">
            <li>
                    <a class="class" href="#Error">Error</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Error.__init__">Error</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#AuthError">AuthError</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="class" href="#ConnectionError">ConnectionError</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="class" href="#NotFoundError">NotFoundError</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="class" href="#TimeoutError">TimeoutError</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="class" href="#List">List</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#List.__init__">List</a>
                        </li>
                        <li>
                                <a class="variable" href="#List.href">href</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Struct">Struct</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Struct.__init__">Struct</a>
                        </li>
                        <li>
                                <a class="variable" href="#Struct.href">href</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Connection">Connection</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Connection.__init__">Connection</a>
                        </li>
                        <li>
                                <a class="function" href="#Connection.send">send</a>
                        </li>
                        <li>
                                <a class="function" href="#Connection.authenticate">authenticate</a>
                        </li>
                        <li>
                                <a class="function" href="#Connection.wait">wait</a>
                        </li>
                        <li>
                                <a class="variable" href="#Connection.url">url</a>
                        </li>
                        <li>
                                <a class="function" href="#Connection.system_service">system_service</a>
                        </li>
                        <li>
                                <a class="function" href="#Connection.service">service</a>
                        </li>
                        <li>
                                <a class="function" href="#Connection.test">test</a>
                        </li>
                        <li>
                                <a class="function" href="#Connection.is_link">is_link</a>
                        </li>
                        <li>
                                <a class="function" href="#Connection.follow_link">follow_link</a>
                        </li>
                        <li>
                                <a class="function" href="#Connection.close">close</a>
                        </li>
                        <li>
                                <a class="function" href="#Connection.check_xml_content_type">check_xml_content_type</a>
                        </li>
                        <li>
                                <a class="function" href="#Connection.check_json_content_type">check_json_content_type</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#ConnectionBuilder">ConnectionBuilder</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#ConnectionBuilder.__init__">ConnectionBuilder</a>
                        </li>
                        <li>
                                <a class="function" href="#ConnectionBuilder.build">build</a>
                        </li>
                </ul>

            </li>
    </ul>



                    <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev">
                        built with <span class="visually-hidden">pdoc</span><img
                            alt="pdoc logo"
                            src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
                    </a>
            </div>
        </nav>
    <main class="pdoc">
            <section>
                    <h1 class="modulename">
ovirtsdk4    </h1>

                
                        <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>

<span class="c1">#</span>
<span class="c1"># Copyright (c) 2016 Red Hat, Inc.</span>
<span class="c1">#</span>
<span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1">#   http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>
<span class="c1">#</span>

<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pycurl</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">six</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">threading</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">urlencode</span><span class="p">,</span> <span class="n">urlparse</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">urllib</span> <span class="kn">import</span> <span class="n">urlencode</span>
    <span class="kn">from</span> <span class="nn">urlparse</span> <span class="kn">import</span> <span class="n">urlparse</span>

<span class="kn">from</span> <span class="nn">ovirtsdk4</span> <span class="kn">import</span> <span class="n">version</span>
<span class="kn">from</span> <span class="nn">ovirtsdk4.http</span> <span class="kn">import</span> <span class="n">Response</span>


<span class="k">class</span> <span class="nc">Error</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    General exception which is thrown by SDK,</span>
<span class="sd">    indicates that some exception happened in SDK.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fault</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates an instance of Error class.</span>

<span class="sd">        `message`:: The exception message.</span>

<span class="sd">        `code`:: An error code associated to the error. For HTTP related</span>
<span class="sd">        errors, this will be the HTTP response code returned by the server.</span>
<span class="sd">        For example, if retrieving of a virtual machine fails because it</span>
<span class="sd">        doesn&#39;t exist this attribute will contain the integer value 404. Note</span>
<span class="sd">        that this may be `nil` if the error is not HTTP related.</span>

<span class="sd">        `fault`:: The `Fault` object associated to the error.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Error</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">code</span> <span class="o">=</span> <span class="n">code</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fault</span> <span class="o">=</span> <span class="n">fault</span>


<span class="k">class</span> <span class="nc">AuthError</span><span class="p">(</span><span class="n">Error</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class of error indicates that an authentiation or authorization</span>
<span class="sd">    problem happenend, like incorrect user name, incorrect password, or</span>
<span class="sd">    missing permissions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">ConnectionError</span><span class="p">(</span><span class="n">Error</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class of error indicates that the name of the server or the name of</span>
<span class="sd">    the proxy can&#39;t be resolved to an IP address, or that the connection</span>
<span class="sd">    can&#39;t be stablished because the server is down or unreachable.</span>

<span class="sd">    Note that for this class of error the `code` and `fault` attributes will</span>
<span class="sd">    always be empty, as no response from the server will be available to</span>
<span class="sd">    populate them.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">NotFoundError</span><span class="p">(</span><span class="n">Error</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class of error indicates that an object can&#39;t be found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">TimeoutError</span><span class="p">(</span><span class="n">Error</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class of error indicates that an operation timed out.</span>

<span class="sd">    Note that for this class of error the `code` and `fault` attributes will</span>
<span class="sd">    always be empty, as no response from the server will be available to</span>
<span class="sd">    populate them.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">List</span><span class="p">(</span><span class="nb">list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is the base class for all the list types of the SDK. It contains the</span>
<span class="sd">    utility methods used by all of them.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">href</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">List</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_href</span> <span class="o">=</span> <span class="n">href</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">href</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the value of the `href` attribute.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_href</span>

    <span class="nd">@href</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">href</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the value of the `href` attribute.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_href</span> <span class="o">=</span> <span class="n">value</span>


<span class="k">class</span> <span class="nc">Struct</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is the base class for all the struct types of the SDK. It contains</span>
<span class="sd">    the utility methods used by all of them.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">href</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Struct</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_href</span> <span class="o">=</span> <span class="n">href</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">href</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the value of the `href` attribute.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_href</span>

    <span class="nd">@href</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">href</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the value of the `href` attribute.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_href</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_check_type</span><span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">expected</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks that the given types match, and generates an exception if</span>
<span class="sd">        they don&#39;t.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">actual</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">actual</span> <span class="o">==</span> <span class="n">expected</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">((</span>
                    <span class="s2">&quot;The type &#39;</span><span class="si">{actual}</span><span class="s2">&#39; isn&#39;t valid for &quot;</span>
                    <span class="s2">&quot;attribute &#39;</span><span class="si">{attribute}</span><span class="s2">&#39;, it must be &quot;</span>
                    <span class="s2">&quot;&#39;</span><span class="si">{expected}</span><span class="s2">&#39;&quot;</span>
                <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">attribute</span><span class="o">=</span><span class="n">attribute</span><span class="p">,</span>
                    <span class="n">actual</span><span class="o">=</span><span class="n">actual</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                    <span class="n">expected</span><span class="o">=</span><span class="n">expected</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                <span class="p">))</span>


<span class="k">class</span> <span class="nc">Connection</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class is responsible for managing an HTTP connection to the engine</span>
<span class="sd">    server. It is intended as the entry point for the SDK, and it provides</span>
<span class="sd">    access to the `system` service and, from there, to the rest of the</span>
<span class="sd">    services provided by the API.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Regular expression used to check XML content type.</span>
    <span class="n">__XML_CONTENT_TYPE_RE</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^\s*(application|text)/xml\s*(;.*)?$&quot;</span><span class="p">)</span>

    <span class="c1"># Regular expression used to check JSON content type.</span>
    <span class="n">__JSON_CONTENT_TYPE_RE</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^\s*(application|text)/json\s*(;.*)?$&quot;</span><span class="p">)</span>

    <span class="c1"># The typical URL path, used just to generate informative error messages.</span>
    <span class="n">__TYPICAL_PATH</span> <span class="o">=</span> <span class="s1">&#39;/ovirt-engine/api&#39;</span>

    <span class="c1"># Debug types that we know how to handle. Everything else will be</span>
    <span class="c1"># silently ignored.</span>
    <span class="n">__KNOWN_DEBUG_TYPES</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">pycurl</span><span class="o">.</span><span class="n">INFOTYPE_TEXT</span><span class="p">,</span>
        <span class="n">pycurl</span><span class="o">.</span><span class="n">INFOTYPE_HEADER_IN</span><span class="p">,</span>
        <span class="n">pycurl</span><span class="o">.</span><span class="n">INFOTYPE_HEADER_OUT</span><span class="p">,</span>
        <span class="n">pycurl</span><span class="o">.</span><span class="n">INFOTYPE_DATA_IN</span><span class="p">,</span>
        <span class="n">pycurl</span><span class="o">.</span><span class="n">INFOTYPE_DATA_OUT</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="c1"># Prefixes to use for debug data types:</span>
    <span class="n">__DEBUG_PREFIXES</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">pycurl</span><span class="o">.</span><span class="n">INFOTYPE_TEXT</span><span class="p">:</span> <span class="s1">&#39;* &#39;</span><span class="p">,</span>
        <span class="n">pycurl</span><span class="o">.</span><span class="n">INFOTYPE_HEADER_IN</span><span class="p">:</span> <span class="s1">&#39;&gt; &#39;</span><span class="p">,</span>
        <span class="n">pycurl</span><span class="o">.</span><span class="n">INFOTYPE_HEADER_OUT</span><span class="p">:</span> <span class="s1">&#39;&lt; &#39;</span><span class="p">,</span>
        <span class="n">pycurl</span><span class="o">.</span><span class="n">INFOTYPE_DATA_IN</span><span class="p">:</span> <span class="s1">&#39;&gt; &#39;</span><span class="p">,</span>
        <span class="n">pycurl</span><span class="o">.</span><span class="n">INFOTYPE_DATA_OUT</span><span class="p">:</span> <span class="s1">&#39;&lt; &#39;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">username</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">password</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">token</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">insecure</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">ca_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">log</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">kerberos</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">timeout</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">compress</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">sso_url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">sso_revoke_url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">sso_token_name</span><span class="o">=</span><span class="s1">&#39;access_token&#39;</span><span class="p">,</span>
        <span class="n">headers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">pipeline</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">connections</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a new connection to the API server.</span>

<span class="sd">        This method supports the following parameters:</span>

<span class="sd">        `url`:: A string containing the base URL of the server, usually</span>
<span class="sd">        something like `https://server.example.com/ovirt-engine/api`.</span>

<span class="sd">        `username`:: The name of the user, something like `admin@internal`.</span>

<span class="sd">        `password`:: The name password of the user.</span>

<span class="sd">        `token`:: : The token to be used to access API. Optionally, user can</span>
<span class="sd">        use token, instead of username and password to access API. If user</span>
<span class="sd">        don&#39;t specify `token` parameter, SDK will automatically create one.</span>

<span class="sd">        `insecure`:: A boolean flag that indicates if the server TLS</span>
<span class="sd">        certificate and host name should be checked.</span>

<span class="sd">        `ca_file`:: A PEM file containing the trusted CA certificates. The</span>
<span class="sd">        certificate presented by the server will be verified using these CA</span>
<span class="sd">        certificates. If `ca_file` parameter is not set, system wide</span>
<span class="sd">        CA certificate store is used.</span>

<span class="sd">        `debug`:: A boolean flag indicating if debug output should be</span>
<span class="sd">        generated. If the value is `True` and the `log` parameter isn&#39;t</span>
<span class="sd">        `None` then the data sent to and received from the server will</span>
<span class="sd">        be written to the log. Be aware that user names and passwords will</span>
<span class="sd">        also be written, so handle it with care.</span>

<span class="sd">        `log`:: The logger where the log messages will be written.</span>

<span class="sd">        `kerberos`:: A boolean flag indicating if Kerberos</span>
<span class="sd">        authentication should be used instead of the default basic</span>
<span class="sd">        authentication.</span>

<span class="sd">        `timeout`:: The maximum total time to wait for the response, in</span>
<span class="sd">        seconds. A value of zero (the default) means wait for ever. If</span>
<span class="sd">        the timeout expires before the response is received an exception</span>
<span class="sd">        will be raised.</span>

<span class="sd">        `compress`:: A boolean flag indicating if the SDK should ask</span>
<span class="sd">        the server to send compressed responses. The default is `True`.</span>
<span class="sd">        Note that this is a hint for the server, and that it may return</span>
<span class="sd">        uncompressed data even when this parameter is set to `True`.</span>
<span class="sd">        Note that compression will be disabled if user pass `debug`</span>
<span class="sd">        parameter set to `true`, so the debug messages are in plain text.</span>

<span class="sd">        `sso_url`:: A string containing the base SSO URL of the serve.</span>
<span class="sd">        Default SSO url is computed from the `url` if no `sso_url` is provided.</span>

<span class="sd">        `sso_revoke_url`:: A string containing the base URL of the SSO</span>
<span class="sd">        revoke service. This needs to be specified only when using</span>
<span class="sd">        an external authentication service. By default this URL</span>
<span class="sd">        is automatically calculated from the value of the `url` parameter,</span>
<span class="sd">        so that SSO token revoke will be performed using the SSO service</span>
<span class="sd">        that is part of the engine.</span>

<span class="sd">        `sso_token_name`:: The token name in the JSON SSO response returned</span>
<span class="sd">        from the SSO server. Default value is `access_token`.</span>

<span class="sd">        `headers`:: A dictionary with headers which should be send with every</span>
<span class="sd">        request.</span>

<span class="sd">        `connections`:: The maximum number of connections to open to the host.</span>
<span class="sd">        If the value is `0` (the default) then the number of connections will</span>
<span class="sd">        be unlimited.</span>

<span class="sd">        `pipeline`:: The maximum number of request to put in an HTTP pipeline</span>
<span class="sd">        without waiting for the response. If the value is `0` (the default)</span>
<span class="sd">        then pipelining is disabled.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Check mandatory parameters:</span>
        <span class="k">if</span> <span class="n">url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">Error</span><span class="p">(</span><span class="s1">&#39;The </span><span class="se">\&#39;</span><span class="s1">url</span><span class="se">\&#39;</span><span class="s1"> parameter is mandatory&#39;</span><span class="p">)</span>

        <span class="c1"># Check that the CA file exists if insecure is not set:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">insecure</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ca_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">ca_file</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">Error</span><span class="p">(</span><span class="s1">&#39;The CA file </span><span class="se">\&#39;</span><span class="si">%s</span><span class="se">\&#39;</span><span class="s1"> doesn</span><span class="se">\&#39;</span><span class="s1">t exist&#39;</span> <span class="o">%</span> <span class="n">ca_file</span><span class="p">)</span>

        <span class="c1"># Save the URL:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_url</span> <span class="o">=</span> <span class="n">url</span>

        <span class="c1"># Save the logger:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span> <span class="o">=</span> <span class="n">log</span>

        <span class="c1"># Save the credentials:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_username</span> <span class="o">=</span> <span class="n">username</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_password</span> <span class="o">=</span> <span class="n">password</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sso_token</span> <span class="o">=</span> <span class="n">token</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_kerberos</span> <span class="o">=</span> <span class="n">kerberos</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ca_file</span> <span class="o">=</span> <span class="n">ca_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_insecure</span> <span class="o">=</span> <span class="n">insecure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_timeout</span> <span class="o">=</span> <span class="n">timeout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_debug</span> <span class="o">=</span> <span class="n">debug</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_compress</span> <span class="o">=</span> <span class="n">compress</span>

        <span class="c1"># The curl object can be used by several threads, but not</span>
        <span class="c1"># simultaneously, so we need a lock to prevent that:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_curl_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>

        <span class="c1"># Set SSO attributes:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sso_url</span> <span class="o">=</span> <span class="n">sso_url</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sso_revoke_url</span> <span class="o">=</span> <span class="n">sso_revoke_url</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sso_token_name</span> <span class="o">=</span> <span class="n">sso_token_name</span>

        <span class="c1"># Headers:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span> <span class="o">=</span> <span class="n">headers</span> <span class="ow">or</span> <span class="p">{}</span>

        <span class="c1"># Create the curl handle that manages the pool of connections:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_multi</span> <span class="o">=</span> <span class="n">pycurl</span><span class="o">.</span><span class="n">CurlMulti</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_multi</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">M_PIPELINING</span><span class="p">,</span> <span class="nb">bool</span><span class="p">(</span><span class="n">pipeline</span><span class="p">))</span>
        <span class="c1"># Since libcurl 7.30.0:</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">pycurl</span><span class="p">,</span> <span class="s1">&#39;M_MAX_PIPELINE_LENGTH&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_multi</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">M_MAX_PIPELINE_LENGTH</span><span class="p">,</span> <span class="n">pipeline</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_multi</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">M_MAX_HOST_CONNECTIONS</span><span class="p">,</span> <span class="n">connections</span><span class="p">)</span>

        <span class="c1"># Connections:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_curls</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="c1"># Initialize the reference to the system service:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__system_service</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">send</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sends an HTTP request and waits for the response.</span>

<span class="sd">        This method is intended for internal use by other components of the</span>
<span class="sd">        SDK. Refrain from using it directly, as backwards compatibility isn&#39;t</span>
<span class="sd">        guaranteed.</span>

<span class="sd">        This method supports the following parameters.</span>

<span class="sd">        `request`:: The Request object containing the details of the HTTP</span>
<span class="sd">        request to send.</span>

<span class="sd">        The returned value is a Request object containing the details of the</span>
<span class="sd">        HTTP response received.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curl_lock</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__send</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">authenticate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return token which can be used for authentication instead of credentials.</span>
<span class="sd">        It will be created, if it not exists, yet. By default the token will be</span>
<span class="sd">        revoked when the connection is closed, unless the `logout` parameter of</span>
<span class="sd">        the `close` method is `False`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sso_token</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sso_token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_access_token</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sso_token</span>
        <span class="k">except</span> <span class="n">pycurl</span><span class="o">.</span><span class="n">error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__parse_error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__send</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="c1"># Create SSO token if needed:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">authenticate</span><span class="p">()</span>

        <span class="c1"># Init curl easy:</span>
        <span class="n">curl</span> <span class="o">=</span> <span class="n">pycurl</span><span class="o">.</span><span class="n">Curl</span><span class="p">()</span>
        <span class="n">curl</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">COOKIEFILE</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="c1"># Configure TLS parameters:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_url</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;https&#39;</span><span class="p">):</span>
            <span class="n">curl</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">SSL_VERIFYPEER</span><span class="p">,</span> <span class="mi">0</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_insecure</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">curl</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">SSL_VERIFYHOST</span><span class="p">,</span> <span class="mi">0</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_insecure</span> <span class="k">else</span> <span class="mi">2</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ca_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">curl</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">CAINFO</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ca_file</span><span class="p">)</span>

        <span class="c1"># Configure timeouts:</span>
        <span class="n">curl</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">TIMEOUT</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_timeout</span><span class="p">)</span>

        <span class="c1"># Configure compression of responses (setting the value to a zero</span>
        <span class="c1"># length string means accepting all the compression types that</span>
        <span class="c1"># libcurl supports):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compress</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_debug</span><span class="p">:</span>
            <span class="n">curl</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">ENCODING</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="c1"># Configure debug mode:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_debug</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">curl</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">curl</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">DEBUGFUNCTION</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curl_debug</span><span class="p">)</span>

        <span class="c1"># Set the method:</span>
        <span class="n">curl</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">CUSTOMREQUEST</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span><span class="p">)</span>

        <span class="c1"># Build the URL:</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_url</span><span class="p">(</span>
            <span class="n">path</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
            <span class="n">query</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">query</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">curl</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">URL</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>

        <span class="c1"># Older versions of the engine (before 4.1) required the</span>
        <span class="c1"># &#39;all_content&#39; parameter as an HTTP header instead of a query</span>
        <span class="c1"># parameter. In order to better support these older versions of</span>
        <span class="c1"># the engine we need to check if this parameter is included in</span>
        <span class="c1"># the request, and add the corresponding header.</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">query</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">all_content</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;all_content&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">all_content</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;All-Content&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_content</span>

        <span class="c1"># Add global headers:</span>
        <span class="n">headers_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># Add headers, avoiding those that have no value:</span>
        <span class="n">header_lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">header_name</span><span class="p">,</span> <span class="n">header_value</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">header_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">headers_dict</span><span class="p">[</span><span class="n">header_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">header_value</span>

        <span class="k">for</span> <span class="n">header_name</span><span class="p">,</span> <span class="n">header_value</span> <span class="ow">in</span> <span class="n">headers_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">header_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">header_name</span><span class="p">,</span> <span class="n">header_value</span><span class="p">))</span>

        <span class="n">header_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;User-Agent: PythonSDK/</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">version</span><span class="o">.</span><span class="n">VERSION</span><span class="p">)</span>
        <span class="n">header_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Version: 4&#39;</span><span class="p">)</span>
        <span class="n">header_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Content-Type: application/xml&#39;</span><span class="p">)</span>
        <span class="n">header_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Accept: application/xml&#39;</span><span class="p">)</span>
        <span class="n">header_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Authorization: Bearer </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sso_token</span><span class="p">)</span>

        <span class="c1"># Make sure headers values are strings, because</span>
        <span class="c1"># pycurl version 7.19.0 supports only string in headers</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">header</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">header_lines</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">header_lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">header</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">UnicodeEncodeError</span><span class="p">,</span> <span class="ne">UnicodeDecodeError</span><span class="p">):</span>
                <span class="n">header_name</span><span class="p">,</span> <span class="n">header_value</span> <span class="o">=</span> <span class="n">header</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">Error</span><span class="p">(</span>
                    <span class="s2">&quot;The value &#39;</span><span class="si">{header_value}</span><span class="s2">&#39; of header &#39;</span><span class="si">{header_name}</span><span class="s2">&#39; &quot;</span>
                    <span class="s2">&quot;contains characters that can&#39;t be encoded using ASCII, &quot;</span>
                    <span class="s2">&quot;as required by the HTTP protocol.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">header_value</span><span class="o">=</span><span class="n">header_value</span><span class="p">,</span>
                        <span class="n">header_name</span><span class="o">=</span><span class="n">header_name</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>

        <span class="c1"># Copy headers and the request body to the curl object:</span>
        <span class="n">curl</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">HTTPHEADER</span><span class="p">,</span> <span class="n">header_lines</span><span class="p">)</span>
        <span class="n">body</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">body</span>
        <span class="k">if</span> <span class="n">body</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">body</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="c1"># HTTP pipelining is valid only for idempotent operations,</span>
        <span class="c1"># pycurl automatically disables pipelining if COPYPOSTFIELDS</span>
        <span class="c1"># is set, even if pipelining is explicitly set.</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;PUT&#39;</span><span class="p">]:</span>
            <span class="n">curl</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">COPYPOSTFIELDS</span><span class="p">,</span> <span class="n">body</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>

        <span class="c1"># Prepare the buffers to receive the response:</span>
        <span class="n">body_buf</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
        <span class="n">headers_buf</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
        <span class="n">curl</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">WRITEFUNCTION</span><span class="p">,</span> <span class="n">body_buf</span><span class="o">.</span><span class="n">write</span><span class="p">)</span>
        <span class="n">curl</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">HEADERFUNCTION</span><span class="p">,</span> <span class="n">headers_buf</span><span class="o">.</span><span class="n">write</span><span class="p">)</span>

        <span class="c1"># Add the curl easy to the multi handle:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_multi</span><span class="o">.</span><span class="n">add_handle</span><span class="p">(</span><span class="n">curl</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">curl</span><span class="p">,</span> <span class="n">body_buf</span><span class="p">,</span> <span class="n">headers_buf</span><span class="p">,</span> <span class="n">request</span>

    <span class="k">def</span> <span class="nf">wait</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">failed_auth</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curl_lock</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__wait</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">failed_auth</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">pycurl</span><span class="o">.</span><span class="n">error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__parse_error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__wait</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">failed_auth</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">ret</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_multi</span><span class="o">.</span><span class="n">perform</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">ret</span> <span class="o">!=</span> <span class="n">pycurl</span><span class="o">.</span><span class="n">E_CALL_MULTI_PERFORM</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">num_q</span><span class="p">,</span> <span class="n">ok_list</span><span class="p">,</span> <span class="n">err_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_multi</span><span class="o">.</span><span class="n">info_read</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_curls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curls</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">ok_list</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">err_list</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">Error</span><span class="p">(</span><span class="s2">&quot;Failed to read response: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">err_list</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">context</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curls</span><span class="p">:</span>
                    <span class="c1"># Remove the curl:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_curls</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">context</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_multi</span><span class="o">.</span><span class="n">remove_handle</span><span class="p">(</span><span class="n">context</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

                    <span class="c1"># Read the response:</span>
                    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_reponse</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>

                    <span class="c1"># If the request failed because of authentication, and it</span>
                    <span class="c1"># wasn&#39;t a request to the SSO service, then the most likely</span>
                    <span class="c1"># cause is an expired SSO token. In this case we need to</span>
                    <span class="c1"># request a new token, and try the original request again, but</span>
                    <span class="c1"># only once. It if fails again, we just return the failed</span>
                    <span class="c1"># response.</span>
                    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="mi">401</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">failed_auth</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_sso_token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_access_token</span><span class="p">()</span>
                        <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__send</span><span class="p">(</span><span class="n">context</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
                        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__wait</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">response</span>
                <span class="k">elif</span> <span class="n">num_q</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_multi</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a string containing the base URL used by this connection.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_url</span>

    <span class="k">def</span> <span class="nf">_revoke_access_token</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Revokes access token</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Build the SSO revoke URL:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sso_revoke_url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_url</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sso_revoke_url</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s1">&#39;</span><span class="si">{url}</span><span class="s1">/ovirt-engine/services/sso-logout&#39;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">url</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{scheme}</span><span class="s1">://</span><span class="si">{netloc}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">scheme</span><span class="o">=</span><span class="n">url</span><span class="o">.</span><span class="n">scheme</span><span class="p">,</span>
                    <span class="n">netloc</span><span class="o">=</span><span class="n">url</span><span class="o">.</span><span class="n">netloc</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="c1"># Construct POST data:</span>
        <span class="n">post_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;scope&#39;</span><span class="p">:</span> <span class="s1">&#39;ovirt-app-api&#39;</span><span class="p">,</span>
            <span class="s1">&#39;token&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sso_token</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="c1"># Send SSO request:</span>
        <span class="n">sso_response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_sso_response</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sso_revoke_url</span><span class="p">,</span> <span class="n">post_data</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sso_response</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">sso_response</span> <span class="o">=</span> <span class="n">sso_response</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="s1">&#39;error&#39;</span> <span class="ow">in</span> <span class="n">sso_response</span><span class="p">:</span>
            <span class="n">sso_error</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_sso_error</span><span class="p">(</span><span class="n">sso_response</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">AuthError</span><span class="p">(</span>
                <span class="s1">&#39;Error during SSO revoke </span><span class="si">%s</span><span class="s1"> : </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">sso_error</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">sso_error</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_access_token</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates access token which reflect authentication method.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Build SSO URL:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kerberos</span><span class="p">:</span>
            <span class="n">entry_point</span> <span class="o">=</span> <span class="s1">&#39;token-http-auth&#39;</span>
            <span class="n">grant_type</span> <span class="o">=</span> <span class="s1">&#39;urn:ovirt:params:oauth:grant-type:http&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">entry_point</span> <span class="o">=</span> <span class="s1">&#39;token&#39;</span>
            <span class="n">grant_type</span> <span class="o">=</span> <span class="s1">&#39;password&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sso_url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_url</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sso_url</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s1">&#39;</span><span class="si">{url}</span><span class="s1">/ovirt-engine/sso/oauth/</span><span class="si">{entry_point}</span><span class="s1">&#39;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">url</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{scheme}</span><span class="s1">://</span><span class="si">{netloc}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">scheme</span><span class="o">=</span><span class="n">url</span><span class="o">.</span><span class="n">scheme</span><span class="p">,</span>
                    <span class="n">netloc</span><span class="o">=</span><span class="n">url</span><span class="o">.</span><span class="n">netloc</span>
                <span class="p">),</span>
                <span class="n">entry_point</span><span class="o">=</span><span class="n">entry_point</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># Construct POST data:</span>
        <span class="n">post_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;grant_type&#39;</span><span class="p">:</span> <span class="n">grant_type</span><span class="p">,</span>
            <span class="s1">&#39;scope&#39;</span><span class="p">:</span> <span class="s1">&#39;ovirt-app-api&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kerberos</span><span class="p">:</span>
            <span class="n">post_data</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
                <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_username</span><span class="p">,</span>
                <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_password</span><span class="p">,</span>
            <span class="p">})</span>

        <span class="c1"># Send SSO request:</span>
        <span class="n">sso_response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_sso_response</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sso_url</span><span class="p">,</span> <span class="n">post_data</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sso_response</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">sso_response</span> <span class="o">=</span> <span class="n">sso_response</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="s1">&#39;error&#39;</span> <span class="ow">in</span> <span class="n">sso_response</span><span class="p">:</span>
            <span class="n">sso_error</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_sso_error</span><span class="p">(</span><span class="n">sso_response</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">AuthError</span><span class="p">(</span>
                <span class="s1">&#39;Error during SSO authentication </span><span class="si">%s</span><span class="s1"> : </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">sso_error</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">sso_error</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">sso_response</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_sso_token_name</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_get_sso_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sso_response</span><span class="p">):</span>
        <span class="c1"># OpenId define `error_description` field, OAuth doesn&#39;t:</span>
        <span class="k">if</span> <span class="s1">&#39;error_description&#39;</span> <span class="ow">in</span> <span class="n">sso_response</span><span class="p">:</span>
            <span class="n">sso_error</span> <span class="o">=</span> <span class="p">(</span><span class="n">sso_response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">),</span> <span class="n">sso_response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;error_description&#39;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sso_error</span> <span class="o">=</span> <span class="p">(</span><span class="n">sso_response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;error_code&#39;</span><span class="p">),</span> <span class="n">sso_response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">sso_error</span>

    <span class="k">def</span> <span class="nf">_get_sso_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform SSO request and return response body data.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Set HTTP method and URL:</span>
        <span class="n">curl</span> <span class="o">=</span> <span class="n">pycurl</span><span class="o">.</span><span class="n">Curl</span><span class="p">()</span>
        <span class="n">curl</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">CUSTOMREQUEST</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">)</span>
        <span class="n">curl</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">URL</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>

        <span class="c1"># Set proper Authorization header if using kerberos:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kerberos</span><span class="p">:</span>
            <span class="n">curl</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">HTTPAUTH</span><span class="p">,</span> <span class="n">pycurl</span><span class="o">.</span><span class="n">HTTPAUTH_GSSNEGOTIATE</span><span class="p">)</span>
            <span class="n">curl</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">USERPWD</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">)</span>

        <span class="c1"># Configure debug mode:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_debug</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">curl</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">curl</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">DEBUGFUNCTION</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curl_debug</span><span class="p">)</span>

        <span class="c1"># Configure TLS parameters:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_url</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;https&#39;</span><span class="p">):</span>
            <span class="n">curl</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">SSL_VERIFYPEER</span><span class="p">,</span> <span class="mi">0</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_insecure</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">curl</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">SSL_VERIFYHOST</span><span class="p">,</span> <span class="mi">0</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_insecure</span> <span class="k">else</span> <span class="mi">2</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ca_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">curl</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">CAINFO</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ca_file</span><span class="p">)</span>

        <span class="c1"># Prepare headers:</span>
        <span class="n">header_lines</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;User-Agent: PythonSDK/</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">version</span><span class="o">.</span><span class="n">VERSION</span><span class="p">,</span>
            <span class="s1">&#39;Accept: application/json&#39;</span>
        <span class="p">]</span>
        <span class="n">curl</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">HTTPHEADER</span><span class="p">,</span> <span class="n">header_lines</span><span class="p">)</span>
        <span class="n">curl</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">COPYPOSTFIELDS</span><span class="p">,</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">params</span><span class="p">))</span>

        <span class="c1"># Prepare the buffer to receive the response:</span>
        <span class="n">body_buf</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
        <span class="n">headers_buf</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>

        <span class="c1"># We ignore all headers which are received before the last response</span>
        <span class="c1"># from the server, because we can be forwarded by apache, and we</span>
        <span class="c1"># are interested only in last response:</span>
        <span class="k">def</span> <span class="nf">write_header</span><span class="p">(</span><span class="n">buf</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">buf</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;HTTP/&#39;</span><span class="p">):</span>
                <span class="n">headers_buf</span><span class="o">.</span><span class="n">truncate</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">headers_buf</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">headers_buf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>

        <span class="n">curl</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">WRITEFUNCTION</span><span class="p">,</span> <span class="n">body_buf</span><span class="o">.</span><span class="n">write</span><span class="p">)</span>
        <span class="n">curl</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">HEADERFUNCTION</span><span class="p">,</span> <span class="n">write_header</span><span class="p">)</span>

        <span class="c1"># Send the request and wait for the response:</span>
        <span class="n">curl</span><span class="o">.</span><span class="n">perform</span><span class="p">()</span>
        <span class="n">curl</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1"># Get headers:</span>
        <span class="n">headers_text</span> <span class="o">=</span> <span class="n">headers_buf</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span>
        <span class="n">header_lines</span> <span class="o">=</span> <span class="n">headers_text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># Check the returned content type:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_content_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__JSON_CONTENT_TYPE_RE</span><span class="p">,</span> <span class="s1">&#39;JSON&#39;</span><span class="p">,</span> <span class="n">header_lines</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">body_buf</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">system_service</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the reference to the root of the services tree.</span>

<span class="sd">        The returned value is an instance of the `SystemService` class.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__system_service</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">ovirtsdk4.services</span> <span class="kn">import</span> <span class="n">SystemService</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__system_service</span> <span class="o">=</span> <span class="n">SystemService</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__system_service</span>

    <span class="k">def</span> <span class="nf">service</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a reference to the service corresponding to the given</span>
<span class="sd">        path. For example, if the `path` parameter is</span>
<span class="sd">        `vms/123/diskattachments` then it will return a reference to</span>
<span class="sd">        the service that manages the disk attachments for the virtual</span>
<span class="sd">        machine with identifier `123`.</span>

<span class="sd">        If there is no service corresponding to the given path an exception</span>
<span class="sd">        will be raised.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">system_service</span><span class="p">()</span><span class="o">.</span><span class="n">service</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raise_exception</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests the connectivity with the server. If connectivity works</span>
<span class="sd">        correctly it returns `True`. If there is any connectivy problem</span>
<span class="sd">        it will either return `False` or raise an exception if the</span>
<span class="sd">        `raise_exception` parameter is `True`.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">system_service</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="n">Error</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">raise_exception</span><span class="p">:</span>
                <span class="n">six</span><span class="o">.</span><span class="n">reraise</span><span class="p">(</span><span class="o">*</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">())</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">raise_exception</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">Error</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">is_link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Indicates if the given object is a link. An object is a link if</span>
<span class="sd">        it has an `href` attribute.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">href</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">follow_link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Follows the `href` attribute of this object, retrieves the object</span>
<span class="sd">        and returns it.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Check that the &quot;href&quot; attribute has a values, as it is needed</span>
        <span class="c1"># in order to retrieve the representation of the object:</span>
        <span class="n">href</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">href</span>
        <span class="k">if</span> <span class="n">href</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">Error</span><span class="p">(</span>
                <span class="s2">&quot;Can&#39;t follow link because the &#39;href&#39; attribute does&#39;t &quot;</span>
                <span class="s2">&quot;have a value&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Check that the value of the &quot;href&quot; attribute is compatible with the</span>
        <span class="c1"># base URL of the connection:</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_url</span><span class="p">)</span><span class="o">.</span><span class="n">path</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">prefix</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">):</span>
            <span class="n">prefix</span> <span class="o">+=</span> <span class="s1">&#39;/&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">href</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">prefix</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">Error</span><span class="p">(</span>
                <span class="s2">&quot;The URL &#39;</span><span class="si">%s</span><span class="s2">&#39; isn&#39;t compatible with the base URL of the &quot;</span>
                <span class="s2">&quot;connection&quot;</span> <span class="o">%</span> <span class="n">href</span>
            <span class="p">)</span>

        <span class="c1"># Remove the prefix from the URL, follow the path to the relevant</span>
        <span class="c1"># service and invoke the &quot;get&quot;, or &quot;list method to retrieve its representation:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">href</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">):]</span>
        <span class="n">service</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">service</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">List</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">service</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">service</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logout</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Releases the resources used by this connection.</span>

<span class="sd">        `logout`:: A boolean, which specify if token should be revoked,</span>
<span class="sd">        and so user should be logged out.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Revoke access token:</span>
        <span class="k">if</span> <span class="n">logout</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sso_token</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_revoke_access_token</span><span class="p">()</span>

        <span class="c1"># Release resources used by the cURL handle:</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curl_lock</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_multi</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_build_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Builds a request URL from a path, and the set of query parameters.</span>

<span class="sd">        This method is intended for internal use by other components of the</span>
<span class="sd">        SDK. Refrain from using it directly, as backwards compatibility isn&#39;t</span>
<span class="sd">        guaranteed.</span>

<span class="sd">        This method supports the following parameters:</span>

<span class="sd">        `path`:: The path that will be added to the base URL. The default is an</span>
<span class="sd">        empty string.</span>

<span class="sd">        `query`:: A dictionary containing the query parameters to add to the</span>
<span class="sd">        URL. The keys of the dictionary should be strings containing the names</span>
<span class="sd">        of the parameters, and the values should be strings containing the</span>
<span class="sd">        values.</span>

<span class="sd">        The returned value is an string containing the URL.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Add the path and the parameters:</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_url</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">query</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">?</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">urlencode</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">items</span><span class="p">())))</span>
        <span class="k">return</span> <span class="n">url</span>

    <span class="k">def</span> <span class="nf">check_xml_content_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">         Checks that the content type of the given response is XML. If it is</span>
<span class="sd">         XML then it does nothing. If it isn&#39;t XML then it raises an</span>
<span class="sd">         exception.</span>

<span class="sd">         `response`:: The HTTP response to check.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_content_type</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__XML_CONTENT_TYPE_RE</span><span class="p">,</span>
            <span class="s1">&#39;XML&#39;</span><span class="p">,</span>
            <span class="n">response</span><span class="o">.</span><span class="n">headers</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">check_json_content_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">         Checks that the content type of the given response is JSON. If it is</span>
<span class="sd">         JSON then it does nothing. If it isn&#39;t JSON then it raises an</span>
<span class="sd">         exception.</span>

<span class="sd">         `response`:: The HTTP response to check.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_content_type</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__JSON_CONTENT_TYPE_RE</span><span class="p">,</span>
            <span class="s1">&#39;JSON&#39;</span><span class="p">,</span>
            <span class="n">response</span><span class="o">.</span><span class="n">headers</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_check_content_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expected_re</span><span class="p">,</span> <span class="n">expected_name</span><span class="p">,</span> <span class="n">headers</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks the given content type and raises an exception if it isn&#39;t the</span>
<span class="sd">        expected one.</span>

<span class="sd">        `expected_re`:: The regular expression used to check the expected</span>
<span class="sd">                        content type.</span>
<span class="sd">        `expected_name`:: The name of the expected content type.</span>
<span class="sd">        `headers`:: The HTTP headers to check.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">content_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_header_value</span><span class="p">(</span><span class="n">headers</span><span class="p">,</span> <span class="s1">&#39;content-type&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">expected_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">content_type</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;The response content type &#39;</span><span class="si">{}</span><span class="s2">&#39; isn&#39;t the expected </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">content_type</span><span class="p">,</span>
                <span class="n">expected_name</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_url</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">url</span><span class="o">.</span><span class="n">path</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__TYPICAL_PATH</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">+=</span> <span class="p">(</span>
                    <span class="s2">&quot;. Is the path &#39;</span><span class="si">{}</span><span class="s2">&#39; included in the &#39;url&#39; &quot;</span>
                    <span class="s2">&quot;parameter correct?&quot;</span>
                <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">url</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
                <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot; The typical one is &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__TYPICAL_PATH</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">Error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_read_reponse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read the response.</span>

<span class="sd">        `context`:: tuple which contains cur easy, response body,</span>
<span class="sd">        response headers, original request</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Extract the response code and body:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">Response</span><span class="p">()</span>
        <span class="n">response</span><span class="o">.</span><span class="n">code</span> <span class="o">=</span> <span class="n">context</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getinfo</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">HTTP_CODE</span><span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">context</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>

        <span class="c1"># The response code can be extracted directly, but cURL doesn&#39;t</span>
        <span class="c1"># have a method to extract the response message, so we have to</span>
        <span class="c1"># parse the first header line to find it:</span>
        <span class="n">response</span><span class="o">.</span><span class="n">reason</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">headers_text</span> <span class="o">=</span> <span class="n">context</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span>
        <span class="n">header_lines</span> <span class="o">=</span> <span class="n">headers_text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">headers</span> <span class="o">=</span> <span class="n">header_lines</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">header_lines</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">response_line</span> <span class="o">=</span> <span class="n">header_lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">response_fields</span> <span class="o">=</span> <span class="n">response_line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">response_fields</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">response</span><span class="o">.</span><span class="n">reason</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">response_fields</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>

        <span class="n">context</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="c1"># Return the response:</span>
        <span class="k">return</span> <span class="n">response</span>

    <span class="k">def</span> <span class="nf">__parse_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">error</span><span class="p">):</span>
        <span class="n">e_code</span> <span class="o">=</span> <span class="n">error</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">clazz</span> <span class="o">=</span> <span class="n">Error</span>
        <span class="n">error_msg</span> <span class="o">=</span> <span class="s2">&quot;Error while sending HTTP request: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">e_code</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="n">pycurl</span><span class="o">.</span><span class="n">E_COULDNT_CONNECT</span><span class="p">,</span> <span class="n">pycurl</span><span class="o">.</span><span class="n">E_COULDNT_RESOLVE_HOST</span>
        <span class="p">]:</span>
            <span class="n">clazz</span> <span class="o">=</span> <span class="ne">ConnectionError</span>
        <span class="k">elif</span> <span class="n">e_code</span> <span class="o">==</span> <span class="n">pycurl</span><span class="o">.</span><span class="n">E_OPERATION_TIMEOUTED</span><span class="p">:</span>
            <span class="n">clazz</span> <span class="o">=</span> <span class="ne">TimeoutError</span>

        <span class="n">six</span><span class="o">.</span><span class="n">reraise</span><span class="p">(</span><span class="n">clazz</span><span class="p">,</span> <span class="n">clazz</span><span class="p">(</span><span class="n">error_msg</span><span class="p">),</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">2</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_get_header_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return header value by its name.</span>

<span class="sd">        `headers`:: list of headers</span>
<span class="sd">        `name`:: name of the header</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">next</span><span class="p">(</span>
            <span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">headers</span> <span class="k">if</span> <span class="n">h</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">name</span><span class="p">)),</span>
            <span class="kc">None</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_curl_debug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">debug_type</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This is the implementation of the cURL debug callback.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Exclude all types of debug data that we don&#39;t know how to</span>
        <span class="c1"># handle, as trying to decode and manipulate that data as</span>
        <span class="c1"># strings will likely fail.</span>
        <span class="k">if</span> <span class="n">debug_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__KNOWN_DEBUG_TYPES</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Some versions of PycURL provide the debug data as strings, and</span>
        <span class="c1"># some as arrays of bytes, so we need to check the type of the</span>
        <span class="c1"># provided data and convert it to strings before trying to</span>
        <span class="c1"># manipulate it with the &quot;replace&quot;, &quot;strip&quot; and &quot;split&quot; methods:</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="nb">bytes</span> <span class="k">else</span> <span class="n">data</span>

        <span class="c1"># Split the debug data into lines and send a debug message for</span>
        <span class="c1"># each line:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__DEBUG_PREFIXES</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">debug_type</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">prefix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">line</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">ConnectionBuilder</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class is a mechanism to simplify the repeated creation of</span>
<span class="sd">    multiple connections. It stores the connection parameters given</span>
<span class="sd">    in its constructor, and has a single `build` method that is</span>
<span class="sd">    equivalent to calling the constructor of the `Connection`</span>
<span class="sd">    class. Typical use will be like this:</span>

<span class="sd">    [source,python]</span>
<span class="sd">    ----</span>
<span class="sd">    # Create the builder once:</span>
<span class="sd">    builder = ConnectionBuilder(</span>
<span class="sd">        url=&#39;https://enginer40.example.com/ovirt-engine/api&#39;,</span>
<span class="sd">        username=&#39;admin@internal&#39;,</span>
<span class="sd">        password=&#39;redhat123&#39;,</span>
<span class="sd">        ca_file=&#39;ca.pem&#39;,</span>
<span class="sd">    )</span>

<span class="sd">    # Create and use first connection:</span>
<span class="sd">    with builder.build() as connection:</span>
<span class="sd">       ...</span>

<span class="sd">    # Create and use a second connection:</span>
<span class="sd">    with builder.build() as connection:</span>
<span class="sd">       ...</span>
<span class="sd">    ----</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a new connection builder. The parameters are the same</span>
<span class="sd">        accepted by the constructor of the `Connnection` class.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>

    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a new connection using the parameters passed to the</span>
<span class="sd">        constructor, and returns it.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">Connection</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_kwargs</span><span class="p">)</span>


<span class="c1"># We need to import readers and writers here, so the generic</span>
<span class="c1"># writer and reader are initialized. This has also benefit that</span>
<span class="c1"># the readers/writers/types/services can be used right after the</span>
<span class="c1"># top level sdk module import, for example:</span>
<span class="c1">#</span>
<span class="c1">#   import ovirtsdk4 as sdk</span>
<span class="c1">#   vm = sdk.types.Vm()</span>
<span class="c1">#</span>
<span class="kn">from</span> <span class="nn">ovirtsdk4</span> <span class="kn">import</span> <span class="n">readers</span>  <span class="c1"># noqa: F401</span>
<span class="kn">from</span> <span class="nn">ovirtsdk4</span> <span class="kn">import</span> <span class="n">services</span>  <span class="c1"># noqa: F401</span>
<span class="kn">from</span> <span class="nn">ovirtsdk4</span> <span class="kn">import</span> <span class="n">types</span>  <span class="c1"># noqa: F401</span>
<span class="kn">from</span> <span class="nn">ovirtsdk4</span> <span class="kn">import</span> <span class="n">writers</span>  <span class="c1"># noqa: F401</span>
</pre></div>

        </details>

            </section>
                <section id="Error">
                                <div class="attr class">
        <a class="headerlink" href="#Error">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">Error</span><wbr>(<span class="base">builtins.Exception</span>):
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">Error</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    General exception which is thrown by SDK,</span>
<span class="sd">    indicates that some exception happened in SDK.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fault</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates an instance of Error class.</span>

<span class="sd">        `message`:: The exception message.</span>

<span class="sd">        `code`:: An error code associated to the error. For HTTP related</span>
<span class="sd">        errors, this will be the HTTP response code returned by the server.</span>
<span class="sd">        For example, if retrieving of a virtual machine fails because it</span>
<span class="sd">        doesn&#39;t exist this attribute will contain the integer value 404. Note</span>
<span class="sd">        that this may be `nil` if the error is not HTTP related.</span>

<span class="sd">        `fault`:: The `Fault` object associated to the error.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Error</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">code</span> <span class="o">=</span> <span class="n">code</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fault</span> <span class="o">=</span> <span class="n">fault</span>
</pre></div>

        </details>

            <div class="docstring"><p>General exception which is thrown by SDK,
indicates that some exception happened in SDK.</p>
</div>


                            <div id="Error.__init__" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Error.__init__">#&nbsp;&nbsp</a>

        
            <span class="name">Error</span><span class="signature">(message, code=None, fault=None)</span>
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fault</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates an instance of Error class.</span>

<span class="sd">        `message`:: The exception message.</span>

<span class="sd">        `code`:: An error code associated to the error. For HTTP related</span>
<span class="sd">        errors, this will be the HTTP response code returned by the server.</span>
<span class="sd">        For example, if retrieving of a virtual machine fails because it</span>
<span class="sd">        doesn&#39;t exist this attribute will contain the integer value 404. Note</span>
<span class="sd">        that this may be `nil` if the error is not HTTP related.</span>

<span class="sd">        `fault`:: The `Fault` object associated to the error.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Error</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">code</span> <span class="o">=</span> <span class="n">code</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fault</span> <span class="o">=</span> <span class="n">fault</span>
</pre></div>

        </details>

            <div class="docstring"><p>Creates an instance of Error class.</p>

<p><code>message</code>:: The exception message.</p>

<p><code>code</code>:: An error code associated to the error. For HTTP related
errors, this will be the HTTP response code returned by the server.
For example, if retrieving of a virtual machine fails because it
doesn't exist this attribute will contain the integer value 404. Note
that this may be <code>nil</code> if the error is not HTTP related.</p>

<p><code>fault</code>:: The <code>Fault</code> object associated to the error.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>builtins.BaseException</dt>
                                <dd id="Error.with_traceback" class="function">with_traceback</dd>
                <dd id="Error.args" class="variable">args</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="AuthError">
                                <div class="attr class">
        <a class="headerlink" href="#AuthError">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">AuthError</span><wbr>(<span class="base"><a href="#Error">Error</a></span>):
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">AuthError</span><span class="p">(</span><span class="n">Error</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class of error indicates that an authentiation or authorization</span>
<span class="sd">    problem happenend, like incorrect user name, incorrect password, or</span>
<span class="sd">    missing permissions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</pre></div>

        </details>

            <div class="docstring"><p>This class of error indicates that an authentiation or authorization
problem happenend, like incorrect user name, incorrect password, or
missing permissions.</p>
</div>


                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#Error">Error</a></dt>
                                <dd id="AuthError.__init__" class="function"><a href="#Error.__init__">Error</a></dd>

            </div>
            <div><dt>builtins.BaseException</dt>
                                <dd id="AuthError.with_traceback" class="function">with_traceback</dd>
                <dd id="AuthError.args" class="variable">args</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="ConnectionError">
                                <div class="attr class">
        <a class="headerlink" href="#ConnectionError">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">ConnectionError</span><wbr>(<span class="base"><a href="#Error">Error</a></span>):
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">ConnectionError</span><span class="p">(</span><span class="n">Error</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class of error indicates that the name of the server or the name of</span>
<span class="sd">    the proxy can&#39;t be resolved to an IP address, or that the connection</span>
<span class="sd">    can&#39;t be stablished because the server is down or unreachable.</span>

<span class="sd">    Note that for this class of error the `code` and `fault` attributes will</span>
<span class="sd">    always be empty, as no response from the server will be available to</span>
<span class="sd">    populate them.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</pre></div>

        </details>

            <div class="docstring"><p>This class of error indicates that the name of the server or the name of
the proxy can't be resolved to an IP address, or that the connection
can't be stablished because the server is down or unreachable.</p>

<p>Note that for this class of error the <code>code</code> and <code>fault</code> attributes will
always be empty, as no response from the server will be available to
populate them.</p>
</div>


                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#Error">Error</a></dt>
                                <dd id="ConnectionError.__init__" class="function"><a href="#Error.__init__">Error</a></dd>

            </div>
            <div><dt>builtins.BaseException</dt>
                                <dd id="ConnectionError.with_traceback" class="function">with_traceback</dd>
                <dd id="ConnectionError.args" class="variable">args</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="NotFoundError">
                                <div class="attr class">
        <a class="headerlink" href="#NotFoundError">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">NotFoundError</span><wbr>(<span class="base"><a href="#Error">Error</a></span>):
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">NotFoundError</span><span class="p">(</span><span class="n">Error</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class of error indicates that an object can&#39;t be found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</pre></div>

        </details>

            <div class="docstring"><p>This class of error indicates that an object can't be found.</p>
</div>


                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#Error">Error</a></dt>
                                <dd id="NotFoundError.__init__" class="function"><a href="#Error.__init__">Error</a></dd>

            </div>
            <div><dt>builtins.BaseException</dt>
                                <dd id="NotFoundError.with_traceback" class="function">with_traceback</dd>
                <dd id="NotFoundError.args" class="variable">args</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="TimeoutError">
                                <div class="attr class">
        <a class="headerlink" href="#TimeoutError">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">TimeoutError</span><wbr>(<span class="base"><a href="#Error">Error</a></span>):
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">TimeoutError</span><span class="p">(</span><span class="n">Error</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class of error indicates that an operation timed out.</span>

<span class="sd">    Note that for this class of error the `code` and `fault` attributes will</span>
<span class="sd">    always be empty, as no response from the server will be available to</span>
<span class="sd">    populate them.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</pre></div>

        </details>

            <div class="docstring"><p>This class of error indicates that an operation timed out.</p>

<p>Note that for this class of error the <code>code</code> and <code>fault</code> attributes will
always be empty, as no response from the server will be available to
populate them.</p>
</div>


                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#Error">Error</a></dt>
                                <dd id="TimeoutError.__init__" class="function"><a href="#Error.__init__">Error</a></dd>

            </div>
            <div><dt>builtins.BaseException</dt>
                                <dd id="TimeoutError.with_traceback" class="function">with_traceback</dd>
                <dd id="TimeoutError.args" class="variable">args</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="List">
                                <div class="attr class">
        <a class="headerlink" href="#List">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">List</span><wbr>(<span class="base">builtins.list</span>):
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">List</span><span class="p">(</span><span class="nb">list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is the base class for all the list types of the SDK. It contains the</span>
<span class="sd">    utility methods used by all of them.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">href</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">List</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_href</span> <span class="o">=</span> <span class="n">href</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">href</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the value of the `href` attribute.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_href</span>

    <span class="nd">@href</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">href</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the value of the `href` attribute.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_href</span> <span class="o">=</span> <span class="n">value</span>
</pre></div>

        </details>

            <div class="docstring"><p>This is the base class for all the list types of the SDK. It contains the
utility methods used by all of them.</p>
</div>


                            <div id="List.__init__" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#List.__init__">#&nbsp;&nbsp</a>

        
            <span class="name">List</span><span class="signature">(href=None)</span>
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">href</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">List</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_href</span> <span class="o">=</span> <span class="n">href</span>
</pre></div>

        </details>

    

                            </div>
                            <div id="List.href" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#List.href">#&nbsp;&nbsp</a>

        <span class="name">href</span>
    </div>

            <div class="docstring"><p>Returns the value of the <code><a href="#List.href">href</a></code> attribute.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>builtins.list</dt>
                                <dd id="List.clear" class="function">clear</dd>
                <dd id="List.copy" class="function">copy</dd>
                <dd id="List.append" class="function">append</dd>
                <dd id="List.insert" class="function">insert</dd>
                <dd id="List.extend" class="function">extend</dd>
                <dd id="List.pop" class="function">pop</dd>
                <dd id="List.remove" class="function">remove</dd>
                <dd id="List.index" class="function">index</dd>
                <dd id="List.count" class="function">count</dd>
                <dd id="List.reverse" class="function">reverse</dd>
                <dd id="List.sort" class="function">sort</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="Struct">
                                <div class="attr class">
        <a class="headerlink" href="#Struct">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">Struct</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">Struct</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is the base class for all the struct types of the SDK. It contains</span>
<span class="sd">    the utility methods used by all of them.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">href</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Struct</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_href</span> <span class="o">=</span> <span class="n">href</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">href</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the value of the `href` attribute.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_href</span>

    <span class="nd">@href</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">href</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the value of the `href` attribute.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_href</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_check_type</span><span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">expected</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks that the given types match, and generates an exception if</span>
<span class="sd">        they don&#39;t.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">actual</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">actual</span> <span class="o">==</span> <span class="n">expected</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">((</span>
                    <span class="s2">&quot;The type &#39;</span><span class="si">{actual}</span><span class="s2">&#39; isn&#39;t valid for &quot;</span>
                    <span class="s2">&quot;attribute &#39;</span><span class="si">{attribute}</span><span class="s2">&#39;, it must be &quot;</span>
                    <span class="s2">&quot;&#39;</span><span class="si">{expected}</span><span class="s2">&#39;&quot;</span>
                <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">attribute</span><span class="o">=</span><span class="n">attribute</span><span class="p">,</span>
                    <span class="n">actual</span><span class="o">=</span><span class="n">actual</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                    <span class="n">expected</span><span class="o">=</span><span class="n">expected</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                <span class="p">))</span>
</pre></div>

        </details>

            <div class="docstring"><p>This is the base class for all the struct types of the SDK. It contains
the utility methods used by all of them.</p>
</div>


                            <div id="Struct.__init__" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Struct.__init__">#&nbsp;&nbsp</a>

        
            <span class="name">Struct</span><span class="signature">(href=None)</span>
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">href</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Struct</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_href</span> <span class="o">=</span> <span class="n">href</span>
</pre></div>

        </details>

    

                            </div>
                            <div id="Struct.href" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#Struct.href">#&nbsp;&nbsp</a>

        <span class="name">href</span>
    </div>

            <div class="docstring"><p>Returns the value of the <code><a href="#Struct.href">href</a></code> attribute.</p>
</div>


                            </div>
                </section>
                <section id="Connection">
                                <div class="attr class">
        <a class="headerlink" href="#Connection">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">Connection</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">Connection</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class is responsible for managing an HTTP connection to the engine</span>
<span class="sd">    server. It is intended as the entry point for the SDK, and it provides</span>
<span class="sd">    access to the `system` service and, from there, to the rest of the</span>
<span class="sd">    services provided by the API.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Regular expression used to check XML content type.</span>
    <span class="n">__XML_CONTENT_TYPE_RE</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^\s*(application|text)/xml\s*(;.*)?$&quot;</span><span class="p">)</span>

    <span class="c1"># Regular expression used to check JSON content type.</span>
    <span class="n">__JSON_CONTENT_TYPE_RE</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^\s*(application|text)/json\s*(;.*)?$&quot;</span><span class="p">)</span>

    <span class="c1"># The typical URL path, used just to generate informative error messages.</span>
    <span class="n">__TYPICAL_PATH</span> <span class="o">=</span> <span class="s1">&#39;/ovirt-engine/api&#39;</span>

    <span class="c1"># Debug types that we know how to handle. Everything else will be</span>
    <span class="c1"># silently ignored.</span>
    <span class="n">__KNOWN_DEBUG_TYPES</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">pycurl</span><span class="o">.</span><span class="n">INFOTYPE_TEXT</span><span class="p">,</span>
        <span class="n">pycurl</span><span class="o">.</span><span class="n">INFOTYPE_HEADER_IN</span><span class="p">,</span>
        <span class="n">pycurl</span><span class="o">.</span><span class="n">INFOTYPE_HEADER_OUT</span><span class="p">,</span>
        <span class="n">pycurl</span><span class="o">.</span><span class="n">INFOTYPE_DATA_IN</span><span class="p">,</span>
        <span class="n">pycurl</span><span class="o">.</span><span class="n">INFOTYPE_DATA_OUT</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="c1"># Prefixes to use for debug data types:</span>
    <span class="n">__DEBUG_PREFIXES</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">pycurl</span><span class="o">.</span><span class="n">INFOTYPE_TEXT</span><span class="p">:</span> <span class="s1">&#39;* &#39;</span><span class="p">,</span>
        <span class="n">pycurl</span><span class="o">.</span><span class="n">INFOTYPE_HEADER_IN</span><span class="p">:</span> <span class="s1">&#39;&gt; &#39;</span><span class="p">,</span>
        <span class="n">pycurl</span><span class="o">.</span><span class="n">INFOTYPE_HEADER_OUT</span><span class="p">:</span> <span class="s1">&#39;&lt; &#39;</span><span class="p">,</span>
        <span class="n">pycurl</span><span class="o">.</span><span class="n">INFOTYPE_DATA_IN</span><span class="p">:</span> <span class="s1">&#39;&gt; &#39;</span><span class="p">,</span>
        <span class="n">pycurl</span><span class="o">.</span><span class="n">INFOTYPE_DATA_OUT</span><span class="p">:</span> <span class="s1">&#39;&lt; &#39;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">username</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">password</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">token</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">insecure</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">ca_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">log</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">kerberos</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">timeout</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">compress</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">sso_url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">sso_revoke_url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">sso_token_name</span><span class="o">=</span><span class="s1">&#39;access_token&#39;</span><span class="p">,</span>
        <span class="n">headers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">pipeline</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">connections</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a new connection to the API server.</span>

<span class="sd">        This method supports the following parameters:</span>

<span class="sd">        `url`:: A string containing the base URL of the server, usually</span>
<span class="sd">        something like `https://server.example.com/ovirt-engine/api`.</span>

<span class="sd">        `username`:: The name of the user, something like `admin@internal`.</span>

<span class="sd">        `password`:: The name password of the user.</span>

<span class="sd">        `token`:: : The token to be used to access API. Optionally, user can</span>
<span class="sd">        use token, instead of username and password to access API. If user</span>
<span class="sd">        don&#39;t specify `token` parameter, SDK will automatically create one.</span>

<span class="sd">        `insecure`:: A boolean flag that indicates if the server TLS</span>
<span class="sd">        certificate and host name should be checked.</span>

<span class="sd">        `ca_file`:: A PEM file containing the trusted CA certificates. The</span>
<span class="sd">        certificate presented by the server will be verified using these CA</span>
<span class="sd">        certificates. If `ca_file` parameter is not set, system wide</span>
<span class="sd">        CA certificate store is used.</span>

<span class="sd">        `debug`:: A boolean flag indicating if debug output should be</span>
<span class="sd">        generated. If the value is `True` and the `log` parameter isn&#39;t</span>
<span class="sd">        `None` then the data sent to and received from the server will</span>
<span class="sd">        be written to the log. Be aware that user names and passwords will</span>
<span class="sd">        also be written, so handle it with care.</span>

<span class="sd">        `log`:: The logger where the log messages will be written.</span>

<span class="sd">        `kerberos`:: A boolean flag indicating if Kerberos</span>
<span class="sd">        authentication should be used instead of the default basic</span>
<span class="sd">        authentication.</span>

<span class="sd">        `timeout`:: The maximum total time to wait for the response, in</span>
<span class="sd">        seconds. A value of zero (the default) means wait for ever. If</span>
<span class="sd">        the timeout expires before the response is received an exception</span>
<span class="sd">        will be raised.</span>

<span class="sd">        `compress`:: A boolean flag indicating if the SDK should ask</span>
<span class="sd">        the server to send compressed responses. The default is `True`.</span>
<span class="sd">        Note that this is a hint for the server, and that it may return</span>
<span class="sd">        uncompressed data even when this parameter is set to `True`.</span>
<span class="sd">        Note that compression will be disabled if user pass `debug`</span>
<span class="sd">        parameter set to `true`, so the debug messages are in plain text.</span>

<span class="sd">        `sso_url`:: A string containing the base SSO URL of the serve.</span>
<span class="sd">        Default SSO url is computed from the `url` if no `sso_url` is provided.</span>

<span class="sd">        `sso_revoke_url`:: A string containing the base URL of the SSO</span>
<span class="sd">        revoke service. This needs to be specified only when using</span>
<span class="sd">        an external authentication service. By default this URL</span>
<span class="sd">        is automatically calculated from the value of the `url` parameter,</span>
<span class="sd">        so that SSO token revoke will be performed using the SSO service</span>
<span class="sd">        that is part of the engine.</span>

<span class="sd">        `sso_token_name`:: The token name in the JSON SSO response returned</span>
<span class="sd">        from the SSO server. Default value is `access_token`.</span>

<span class="sd">        `headers`:: A dictionary with headers which should be send with every</span>
<span class="sd">        request.</span>

<span class="sd">        `connections`:: The maximum number of connections to open to the host.</span>
<span class="sd">        If the value is `0` (the default) then the number of connections will</span>
<span class="sd">        be unlimited.</span>

<span class="sd">        `pipeline`:: The maximum number of request to put in an HTTP pipeline</span>
<span class="sd">        without waiting for the response. If the value is `0` (the default)</span>
<span class="sd">        then pipelining is disabled.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Check mandatory parameters:</span>
        <span class="k">if</span> <span class="n">url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">Error</span><span class="p">(</span><span class="s1">&#39;The </span><span class="se">\&#39;</span><span class="s1">url</span><span class="se">\&#39;</span><span class="s1"> parameter is mandatory&#39;</span><span class="p">)</span>

        <span class="c1"># Check that the CA file exists if insecure is not set:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">insecure</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ca_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">ca_file</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">Error</span><span class="p">(</span><span class="s1">&#39;The CA file </span><span class="se">\&#39;</span><span class="si">%s</span><span class="se">\&#39;</span><span class="s1"> doesn</span><span class="se">\&#39;</span><span class="s1">t exist&#39;</span> <span class="o">%</span> <span class="n">ca_file</span><span class="p">)</span>

        <span class="c1"># Save the URL:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_url</span> <span class="o">=</span> <span class="n">url</span>

        <span class="c1"># Save the logger:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span> <span class="o">=</span> <span class="n">log</span>

        <span class="c1"># Save the credentials:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_username</span> <span class="o">=</span> <span class="n">username</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_password</span> <span class="o">=</span> <span class="n">password</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sso_token</span> <span class="o">=</span> <span class="n">token</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_kerberos</span> <span class="o">=</span> <span class="n">kerberos</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ca_file</span> <span class="o">=</span> <span class="n">ca_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_insecure</span> <span class="o">=</span> <span class="n">insecure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_timeout</span> <span class="o">=</span> <span class="n">timeout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_debug</span> <span class="o">=</span> <span class="n">debug</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_compress</span> <span class="o">=</span> <span class="n">compress</span>

        <span class="c1"># The curl object can be used by several threads, but not</span>
        <span class="c1"># simultaneously, so we need a lock to prevent that:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_curl_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>

        <span class="c1"># Set SSO attributes:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sso_url</span> <span class="o">=</span> <span class="n">sso_url</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sso_revoke_url</span> <span class="o">=</span> <span class="n">sso_revoke_url</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sso_token_name</span> <span class="o">=</span> <span class="n">sso_token_name</span>

        <span class="c1"># Headers:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span> <span class="o">=</span> <span class="n">headers</span> <span class="ow">or</span> <span class="p">{}</span>

        <span class="c1"># Create the curl handle that manages the pool of connections:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_multi</span> <span class="o">=</span> <span class="n">pycurl</span><span class="o">.</span><span class="n">CurlMulti</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_multi</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">M_PIPELINING</span><span class="p">,</span> <span class="nb">bool</span><span class="p">(</span><span class="n">pipeline</span><span class="p">))</span>
        <span class="c1"># Since libcurl 7.30.0:</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">pycurl</span><span class="p">,</span> <span class="s1">&#39;M_MAX_PIPELINE_LENGTH&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_multi</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">M_MAX_PIPELINE_LENGTH</span><span class="p">,</span> <span class="n">pipeline</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_multi</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">M_MAX_HOST_CONNECTIONS</span><span class="p">,</span> <span class="n">connections</span><span class="p">)</span>

        <span class="c1"># Connections:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_curls</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="c1"># Initialize the reference to the system service:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__system_service</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">send</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sends an HTTP request and waits for the response.</span>

<span class="sd">        This method is intended for internal use by other components of the</span>
<span class="sd">        SDK. Refrain from using it directly, as backwards compatibility isn&#39;t</span>
<span class="sd">        guaranteed.</span>

<span class="sd">        This method supports the following parameters.</span>

<span class="sd">        `request`:: The Request object containing the details of the HTTP</span>
<span class="sd">        request to send.</span>

<span class="sd">        The returned value is a Request object containing the details of the</span>
<span class="sd">        HTTP response received.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curl_lock</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__send</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">authenticate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return token which can be used for authentication instead of credentials.</span>
<span class="sd">        It will be created, if it not exists, yet. By default the token will be</span>
<span class="sd">        revoked when the connection is closed, unless the `logout` parameter of</span>
<span class="sd">        the `close` method is `False`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sso_token</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sso_token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_access_token</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sso_token</span>
        <span class="k">except</span> <span class="n">pycurl</span><span class="o">.</span><span class="n">error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__parse_error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__send</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="c1"># Create SSO token if needed:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">authenticate</span><span class="p">()</span>

        <span class="c1"># Init curl easy:</span>
        <span class="n">curl</span> <span class="o">=</span> <span class="n">pycurl</span><span class="o">.</span><span class="n">Curl</span><span class="p">()</span>
        <span class="n">curl</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">COOKIEFILE</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="c1"># Configure TLS parameters:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_url</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;https&#39;</span><span class="p">):</span>
            <span class="n">curl</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">SSL_VERIFYPEER</span><span class="p">,</span> <span class="mi">0</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_insecure</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">curl</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">SSL_VERIFYHOST</span><span class="p">,</span> <span class="mi">0</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_insecure</span> <span class="k">else</span> <span class="mi">2</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ca_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">curl</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">CAINFO</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ca_file</span><span class="p">)</span>

        <span class="c1"># Configure timeouts:</span>
        <span class="n">curl</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">TIMEOUT</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_timeout</span><span class="p">)</span>

        <span class="c1"># Configure compression of responses (setting the value to a zero</span>
        <span class="c1"># length string means accepting all the compression types that</span>
        <span class="c1"># libcurl supports):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compress</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_debug</span><span class="p">:</span>
            <span class="n">curl</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">ENCODING</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="c1"># Configure debug mode:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_debug</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">curl</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">curl</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">DEBUGFUNCTION</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curl_debug</span><span class="p">)</span>

        <span class="c1"># Set the method:</span>
        <span class="n">curl</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">CUSTOMREQUEST</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span><span class="p">)</span>

        <span class="c1"># Build the URL:</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_url</span><span class="p">(</span>
            <span class="n">path</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
            <span class="n">query</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">query</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">curl</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">URL</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>

        <span class="c1"># Older versions of the engine (before 4.1) required the</span>
        <span class="c1"># &#39;all_content&#39; parameter as an HTTP header instead of a query</span>
        <span class="c1"># parameter. In order to better support these older versions of</span>
        <span class="c1"># the engine we need to check if this parameter is included in</span>
        <span class="c1"># the request, and add the corresponding header.</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">query</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">all_content</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;all_content&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">all_content</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;All-Content&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_content</span>

        <span class="c1"># Add global headers:</span>
        <span class="n">headers_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># Add headers, avoiding those that have no value:</span>
        <span class="n">header_lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">header_name</span><span class="p">,</span> <span class="n">header_value</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">header_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">headers_dict</span><span class="p">[</span><span class="n">header_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">header_value</span>

        <span class="k">for</span> <span class="n">header_name</span><span class="p">,</span> <span class="n">header_value</span> <span class="ow">in</span> <span class="n">headers_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">header_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">header_name</span><span class="p">,</span> <span class="n">header_value</span><span class="p">))</span>

        <span class="n">header_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;User-Agent: PythonSDK/</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">version</span><span class="o">.</span><span class="n">VERSION</span><span class="p">)</span>
        <span class="n">header_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Version: 4&#39;</span><span class="p">)</span>
        <span class="n">header_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Content-Type: application/xml&#39;</span><span class="p">)</span>
        <span class="n">header_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Accept: application/xml&#39;</span><span class="p">)</span>
        <span class="n">header_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Authorization: Bearer </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sso_token</span><span class="p">)</span>

        <span class="c1"># Make sure headers values are strings, because</span>
        <span class="c1"># pycurl version 7.19.0 supports only string in headers</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">header</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">header_lines</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">header_lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">header</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">UnicodeEncodeError</span><span class="p">,</span> <span class="ne">UnicodeDecodeError</span><span class="p">):</span>
                <span class="n">header_name</span><span class="p">,</span> <span class="n">header_value</span> <span class="o">=</span> <span class="n">header</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">Error</span><span class="p">(</span>
                    <span class="s2">&quot;The value &#39;</span><span class="si">{header_value}</span><span class="s2">&#39; of header &#39;</span><span class="si">{header_name}</span><span class="s2">&#39; &quot;</span>
                    <span class="s2">&quot;contains characters that can&#39;t be encoded using ASCII, &quot;</span>
                    <span class="s2">&quot;as required by the HTTP protocol.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">header_value</span><span class="o">=</span><span class="n">header_value</span><span class="p">,</span>
                        <span class="n">header_name</span><span class="o">=</span><span class="n">header_name</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>

        <span class="c1"># Copy headers and the request body to the curl object:</span>
        <span class="n">curl</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">HTTPHEADER</span><span class="p">,</span> <span class="n">header_lines</span><span class="p">)</span>
        <span class="n">body</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">body</span>
        <span class="k">if</span> <span class="n">body</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">body</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="c1"># HTTP pipelining is valid only for idempotent operations,</span>
        <span class="c1"># pycurl automatically disables pipelining if COPYPOSTFIELDS</span>
        <span class="c1"># is set, even if pipelining is explicitly set.</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;PUT&#39;</span><span class="p">]:</span>
            <span class="n">curl</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">COPYPOSTFIELDS</span><span class="p">,</span> <span class="n">body</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>

        <span class="c1"># Prepare the buffers to receive the response:</span>
        <span class="n">body_buf</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
        <span class="n">headers_buf</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
        <span class="n">curl</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">WRITEFUNCTION</span><span class="p">,</span> <span class="n">body_buf</span><span class="o">.</span><span class="n">write</span><span class="p">)</span>
        <span class="n">curl</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">HEADERFUNCTION</span><span class="p">,</span> <span class="n">headers_buf</span><span class="o">.</span><span class="n">write</span><span class="p">)</span>

        <span class="c1"># Add the curl easy to the multi handle:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_multi</span><span class="o">.</span><span class="n">add_handle</span><span class="p">(</span><span class="n">curl</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">curl</span><span class="p">,</span> <span class="n">body_buf</span><span class="p">,</span> <span class="n">headers_buf</span><span class="p">,</span> <span class="n">request</span>

    <span class="k">def</span> <span class="nf">wait</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">failed_auth</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curl_lock</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__wait</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">failed_auth</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">pycurl</span><span class="o">.</span><span class="n">error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__parse_error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__wait</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">failed_auth</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">ret</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_multi</span><span class="o">.</span><span class="n">perform</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">ret</span> <span class="o">!=</span> <span class="n">pycurl</span><span class="o">.</span><span class="n">E_CALL_MULTI_PERFORM</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">num_q</span><span class="p">,</span> <span class="n">ok_list</span><span class="p">,</span> <span class="n">err_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_multi</span><span class="o">.</span><span class="n">info_read</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_curls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curls</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">ok_list</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">err_list</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">Error</span><span class="p">(</span><span class="s2">&quot;Failed to read response: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">err_list</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">context</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curls</span><span class="p">:</span>
                    <span class="c1"># Remove the curl:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_curls</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">context</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_multi</span><span class="o">.</span><span class="n">remove_handle</span><span class="p">(</span><span class="n">context</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

                    <span class="c1"># Read the response:</span>
                    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_reponse</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>

                    <span class="c1"># If the request failed because of authentication, and it</span>
                    <span class="c1"># wasn&#39;t a request to the SSO service, then the most likely</span>
                    <span class="c1"># cause is an expired SSO token. In this case we need to</span>
                    <span class="c1"># request a new token, and try the original request again, but</span>
                    <span class="c1"># only once. It if fails again, we just return the failed</span>
                    <span class="c1"># response.</span>
                    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="mi">401</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">failed_auth</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_sso_token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_access_token</span><span class="p">()</span>
                        <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__send</span><span class="p">(</span><span class="n">context</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
                        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__wait</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">response</span>
                <span class="k">elif</span> <span class="n">num_q</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_multi</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a string containing the base URL used by this connection.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_url</span>

    <span class="k">def</span> <span class="nf">_revoke_access_token</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Revokes access token</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Build the SSO revoke URL:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sso_revoke_url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_url</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sso_revoke_url</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s1">&#39;</span><span class="si">{url}</span><span class="s1">/ovirt-engine/services/sso-logout&#39;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">url</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{scheme}</span><span class="s1">://</span><span class="si">{netloc}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">scheme</span><span class="o">=</span><span class="n">url</span><span class="o">.</span><span class="n">scheme</span><span class="p">,</span>
                    <span class="n">netloc</span><span class="o">=</span><span class="n">url</span><span class="o">.</span><span class="n">netloc</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="c1"># Construct POST data:</span>
        <span class="n">post_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;scope&#39;</span><span class="p">:</span> <span class="s1">&#39;ovirt-app-api&#39;</span><span class="p">,</span>
            <span class="s1">&#39;token&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sso_token</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="c1"># Send SSO request:</span>
        <span class="n">sso_response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_sso_response</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sso_revoke_url</span><span class="p">,</span> <span class="n">post_data</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sso_response</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">sso_response</span> <span class="o">=</span> <span class="n">sso_response</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="s1">&#39;error&#39;</span> <span class="ow">in</span> <span class="n">sso_response</span><span class="p">:</span>
            <span class="n">sso_error</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_sso_error</span><span class="p">(</span><span class="n">sso_response</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">AuthError</span><span class="p">(</span>
                <span class="s1">&#39;Error during SSO revoke </span><span class="si">%s</span><span class="s1"> : </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">sso_error</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">sso_error</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_access_token</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates access token which reflect authentication method.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Build SSO URL:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kerberos</span><span class="p">:</span>
            <span class="n">entry_point</span> <span class="o">=</span> <span class="s1">&#39;token-http-auth&#39;</span>
            <span class="n">grant_type</span> <span class="o">=</span> <span class="s1">&#39;urn:ovirt:params:oauth:grant-type:http&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">entry_point</span> <span class="o">=</span> <span class="s1">&#39;token&#39;</span>
            <span class="n">grant_type</span> <span class="o">=</span> <span class="s1">&#39;password&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sso_url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_url</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sso_url</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s1">&#39;</span><span class="si">{url}</span><span class="s1">/ovirt-engine/sso/oauth/</span><span class="si">{entry_point}</span><span class="s1">&#39;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">url</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{scheme}</span><span class="s1">://</span><span class="si">{netloc}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">scheme</span><span class="o">=</span><span class="n">url</span><span class="o">.</span><span class="n">scheme</span><span class="p">,</span>
                    <span class="n">netloc</span><span class="o">=</span><span class="n">url</span><span class="o">.</span><span class="n">netloc</span>
                <span class="p">),</span>
                <span class="n">entry_point</span><span class="o">=</span><span class="n">entry_point</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># Construct POST data:</span>
        <span class="n">post_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;grant_type&#39;</span><span class="p">:</span> <span class="n">grant_type</span><span class="p">,</span>
            <span class="s1">&#39;scope&#39;</span><span class="p">:</span> <span class="s1">&#39;ovirt-app-api&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kerberos</span><span class="p">:</span>
            <span class="n">post_data</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
                <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_username</span><span class="p">,</span>
                <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_password</span><span class="p">,</span>
            <span class="p">})</span>

        <span class="c1"># Send SSO request:</span>
        <span class="n">sso_response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_sso_response</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sso_url</span><span class="p">,</span> <span class="n">post_data</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sso_response</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">sso_response</span> <span class="o">=</span> <span class="n">sso_response</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="s1">&#39;error&#39;</span> <span class="ow">in</span> <span class="n">sso_response</span><span class="p">:</span>
            <span class="n">sso_error</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_sso_error</span><span class="p">(</span><span class="n">sso_response</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">AuthError</span><span class="p">(</span>
                <span class="s1">&#39;Error during SSO authentication </span><span class="si">%s</span><span class="s1"> : </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">sso_error</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">sso_error</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">sso_response</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_sso_token_name</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_get_sso_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sso_response</span><span class="p">):</span>
        <span class="c1"># OpenId define `error_description` field, OAuth doesn&#39;t:</span>
        <span class="k">if</span> <span class="s1">&#39;error_description&#39;</span> <span class="ow">in</span> <span class="n">sso_response</span><span class="p">:</span>
            <span class="n">sso_error</span> <span class="o">=</span> <span class="p">(</span><span class="n">sso_response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">),</span> <span class="n">sso_response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;error_description&#39;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sso_error</span> <span class="o">=</span> <span class="p">(</span><span class="n">sso_response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;error_code&#39;</span><span class="p">),</span> <span class="n">sso_response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">sso_error</span>

    <span class="k">def</span> <span class="nf">_get_sso_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform SSO request and return response body data.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Set HTTP method and URL:</span>
        <span class="n">curl</span> <span class="o">=</span> <span class="n">pycurl</span><span class="o">.</span><span class="n">Curl</span><span class="p">()</span>
        <span class="n">curl</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">CUSTOMREQUEST</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">)</span>
        <span class="n">curl</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">URL</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>

        <span class="c1"># Set proper Authorization header if using kerberos:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kerberos</span><span class="p">:</span>
            <span class="n">curl</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">HTTPAUTH</span><span class="p">,</span> <span class="n">pycurl</span><span class="o">.</span><span class="n">HTTPAUTH_GSSNEGOTIATE</span><span class="p">)</span>
            <span class="n">curl</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">USERPWD</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">)</span>

        <span class="c1"># Configure debug mode:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_debug</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">curl</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">curl</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">DEBUGFUNCTION</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curl_debug</span><span class="p">)</span>

        <span class="c1"># Configure TLS parameters:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_url</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;https&#39;</span><span class="p">):</span>
            <span class="n">curl</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">SSL_VERIFYPEER</span><span class="p">,</span> <span class="mi">0</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_insecure</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">curl</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">SSL_VERIFYHOST</span><span class="p">,</span> <span class="mi">0</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_insecure</span> <span class="k">else</span> <span class="mi">2</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ca_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">curl</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">CAINFO</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ca_file</span><span class="p">)</span>

        <span class="c1"># Prepare headers:</span>
        <span class="n">header_lines</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;User-Agent: PythonSDK/</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">version</span><span class="o">.</span><span class="n">VERSION</span><span class="p">,</span>
            <span class="s1">&#39;Accept: application/json&#39;</span>
        <span class="p">]</span>
        <span class="n">curl</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">HTTPHEADER</span><span class="p">,</span> <span class="n">header_lines</span><span class="p">)</span>
        <span class="n">curl</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">COPYPOSTFIELDS</span><span class="p">,</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">params</span><span class="p">))</span>

        <span class="c1"># Prepare the buffer to receive the response:</span>
        <span class="n">body_buf</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
        <span class="n">headers_buf</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>

        <span class="c1"># We ignore all headers which are received before the last response</span>
        <span class="c1"># from the server, because we can be forwarded by apache, and we</span>
        <span class="c1"># are interested only in last response:</span>
        <span class="k">def</span> <span class="nf">write_header</span><span class="p">(</span><span class="n">buf</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">buf</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;HTTP/&#39;</span><span class="p">):</span>
                <span class="n">headers_buf</span><span class="o">.</span><span class="n">truncate</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">headers_buf</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">headers_buf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>

        <span class="n">curl</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">WRITEFUNCTION</span><span class="p">,</span> <span class="n">body_buf</span><span class="o">.</span><span class="n">write</span><span class="p">)</span>
        <span class="n">curl</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">HEADERFUNCTION</span><span class="p">,</span> <span class="n">write_header</span><span class="p">)</span>

        <span class="c1"># Send the request and wait for the response:</span>
        <span class="n">curl</span><span class="o">.</span><span class="n">perform</span><span class="p">()</span>
        <span class="n">curl</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1"># Get headers:</span>
        <span class="n">headers_text</span> <span class="o">=</span> <span class="n">headers_buf</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span>
        <span class="n">header_lines</span> <span class="o">=</span> <span class="n">headers_text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># Check the returned content type:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_content_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__JSON_CONTENT_TYPE_RE</span><span class="p">,</span> <span class="s1">&#39;JSON&#39;</span><span class="p">,</span> <span class="n">header_lines</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">body_buf</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">system_service</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the reference to the root of the services tree.</span>

<span class="sd">        The returned value is an instance of the `SystemService` class.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__system_service</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">ovirtsdk4.services</span> <span class="kn">import</span> <span class="n">SystemService</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__system_service</span> <span class="o">=</span> <span class="n">SystemService</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__system_service</span>

    <span class="k">def</span> <span class="nf">service</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a reference to the service corresponding to the given</span>
<span class="sd">        path. For example, if the `path` parameter is</span>
<span class="sd">        `vms/123/diskattachments` then it will return a reference to</span>
<span class="sd">        the service that manages the disk attachments for the virtual</span>
<span class="sd">        machine with identifier `123`.</span>

<span class="sd">        If there is no service corresponding to the given path an exception</span>
<span class="sd">        will be raised.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">system_service</span><span class="p">()</span><span class="o">.</span><span class="n">service</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raise_exception</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests the connectivity with the server. If connectivity works</span>
<span class="sd">        correctly it returns `True`. If there is any connectivy problem</span>
<span class="sd">        it will either return `False` or raise an exception if the</span>
<span class="sd">        `raise_exception` parameter is `True`.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">system_service</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="n">Error</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">raise_exception</span><span class="p">:</span>
                <span class="n">six</span><span class="o">.</span><span class="n">reraise</span><span class="p">(</span><span class="o">*</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">())</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">raise_exception</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">Error</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">is_link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Indicates if the given object is a link. An object is a link if</span>
<span class="sd">        it has an `href` attribute.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">href</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">follow_link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Follows the `href` attribute of this object, retrieves the object</span>
<span class="sd">        and returns it.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Check that the &quot;href&quot; attribute has a values, as it is needed</span>
        <span class="c1"># in order to retrieve the representation of the object:</span>
        <span class="n">href</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">href</span>
        <span class="k">if</span> <span class="n">href</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">Error</span><span class="p">(</span>
                <span class="s2">&quot;Can&#39;t follow link because the &#39;href&#39; attribute does&#39;t &quot;</span>
                <span class="s2">&quot;have a value&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Check that the value of the &quot;href&quot; attribute is compatible with the</span>
        <span class="c1"># base URL of the connection:</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_url</span><span class="p">)</span><span class="o">.</span><span class="n">path</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">prefix</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">):</span>
            <span class="n">prefix</span> <span class="o">+=</span> <span class="s1">&#39;/&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">href</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">prefix</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">Error</span><span class="p">(</span>
                <span class="s2">&quot;The URL &#39;</span><span class="si">%s</span><span class="s2">&#39; isn&#39;t compatible with the base URL of the &quot;</span>
                <span class="s2">&quot;connection&quot;</span> <span class="o">%</span> <span class="n">href</span>
            <span class="p">)</span>

        <span class="c1"># Remove the prefix from the URL, follow the path to the relevant</span>
        <span class="c1"># service and invoke the &quot;get&quot;, or &quot;list method to retrieve its representation:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">href</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">):]</span>
        <span class="n">service</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">service</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">List</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">service</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">service</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logout</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Releases the resources used by this connection.</span>

<span class="sd">        `logout`:: A boolean, which specify if token should be revoked,</span>
<span class="sd">        and so user should be logged out.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Revoke access token:</span>
        <span class="k">if</span> <span class="n">logout</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sso_token</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_revoke_access_token</span><span class="p">()</span>

        <span class="c1"># Release resources used by the cURL handle:</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curl_lock</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_multi</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_build_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Builds a request URL from a path, and the set of query parameters.</span>

<span class="sd">        This method is intended for internal use by other components of the</span>
<span class="sd">        SDK. Refrain from using it directly, as backwards compatibility isn&#39;t</span>
<span class="sd">        guaranteed.</span>

<span class="sd">        This method supports the following parameters:</span>

<span class="sd">        `path`:: The path that will be added to the base URL. The default is an</span>
<span class="sd">        empty string.</span>

<span class="sd">        `query`:: A dictionary containing the query parameters to add to the</span>
<span class="sd">        URL. The keys of the dictionary should be strings containing the names</span>
<span class="sd">        of the parameters, and the values should be strings containing the</span>
<span class="sd">        values.</span>

<span class="sd">        The returned value is an string containing the URL.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Add the path and the parameters:</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_url</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">query</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">?</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">urlencode</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">items</span><span class="p">())))</span>
        <span class="k">return</span> <span class="n">url</span>

    <span class="k">def</span> <span class="nf">check_xml_content_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">         Checks that the content type of the given response is XML. If it is</span>
<span class="sd">         XML then it does nothing. If it isn&#39;t XML then it raises an</span>
<span class="sd">         exception.</span>

<span class="sd">         `response`:: The HTTP response to check.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_content_type</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__XML_CONTENT_TYPE_RE</span><span class="p">,</span>
            <span class="s1">&#39;XML&#39;</span><span class="p">,</span>
            <span class="n">response</span><span class="o">.</span><span class="n">headers</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">check_json_content_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">         Checks that the content type of the given response is JSON. If it is</span>
<span class="sd">         JSON then it does nothing. If it isn&#39;t JSON then it raises an</span>
<span class="sd">         exception.</span>

<span class="sd">         `response`:: The HTTP response to check.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_content_type</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__JSON_CONTENT_TYPE_RE</span><span class="p">,</span>
            <span class="s1">&#39;JSON&#39;</span><span class="p">,</span>
            <span class="n">response</span><span class="o">.</span><span class="n">headers</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_check_content_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expected_re</span><span class="p">,</span> <span class="n">expected_name</span><span class="p">,</span> <span class="n">headers</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks the given content type and raises an exception if it isn&#39;t the</span>
<span class="sd">        expected one.</span>

<span class="sd">        `expected_re`:: The regular expression used to check the expected</span>
<span class="sd">                        content type.</span>
<span class="sd">        `expected_name`:: The name of the expected content type.</span>
<span class="sd">        `headers`:: The HTTP headers to check.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">content_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_header_value</span><span class="p">(</span><span class="n">headers</span><span class="p">,</span> <span class="s1">&#39;content-type&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">expected_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">content_type</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;The response content type &#39;</span><span class="si">{}</span><span class="s2">&#39; isn&#39;t the expected </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">content_type</span><span class="p">,</span>
                <span class="n">expected_name</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_url</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">url</span><span class="o">.</span><span class="n">path</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__TYPICAL_PATH</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">+=</span> <span class="p">(</span>
                    <span class="s2">&quot;. Is the path &#39;</span><span class="si">{}</span><span class="s2">&#39; included in the &#39;url&#39; &quot;</span>
                    <span class="s2">&quot;parameter correct?&quot;</span>
                <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">url</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
                <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot; The typical one is &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__TYPICAL_PATH</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">Error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_read_reponse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read the response.</span>

<span class="sd">        `context`:: tuple which contains cur easy, response body,</span>
<span class="sd">        response headers, original request</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Extract the response code and body:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">Response</span><span class="p">()</span>
        <span class="n">response</span><span class="o">.</span><span class="n">code</span> <span class="o">=</span> <span class="n">context</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getinfo</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">HTTP_CODE</span><span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">context</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>

        <span class="c1"># The response code can be extracted directly, but cURL doesn&#39;t</span>
        <span class="c1"># have a method to extract the response message, so we have to</span>
        <span class="c1"># parse the first header line to find it:</span>
        <span class="n">response</span><span class="o">.</span><span class="n">reason</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">headers_text</span> <span class="o">=</span> <span class="n">context</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span>
        <span class="n">header_lines</span> <span class="o">=</span> <span class="n">headers_text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">headers</span> <span class="o">=</span> <span class="n">header_lines</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">header_lines</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">response_line</span> <span class="o">=</span> <span class="n">header_lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">response_fields</span> <span class="o">=</span> <span class="n">response_line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">response_fields</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">response</span><span class="o">.</span><span class="n">reason</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">response_fields</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>

        <span class="n">context</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="c1"># Return the response:</span>
        <span class="k">return</span> <span class="n">response</span>

    <span class="k">def</span> <span class="nf">__parse_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">error</span><span class="p">):</span>
        <span class="n">e_code</span> <span class="o">=</span> <span class="n">error</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">clazz</span> <span class="o">=</span> <span class="n">Error</span>
        <span class="n">error_msg</span> <span class="o">=</span> <span class="s2">&quot;Error while sending HTTP request: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">e_code</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="n">pycurl</span><span class="o">.</span><span class="n">E_COULDNT_CONNECT</span><span class="p">,</span> <span class="n">pycurl</span><span class="o">.</span><span class="n">E_COULDNT_RESOLVE_HOST</span>
        <span class="p">]:</span>
            <span class="n">clazz</span> <span class="o">=</span> <span class="ne">ConnectionError</span>
        <span class="k">elif</span> <span class="n">e_code</span> <span class="o">==</span> <span class="n">pycurl</span><span class="o">.</span><span class="n">E_OPERATION_TIMEOUTED</span><span class="p">:</span>
            <span class="n">clazz</span> <span class="o">=</span> <span class="ne">TimeoutError</span>

        <span class="n">six</span><span class="o">.</span><span class="n">reraise</span><span class="p">(</span><span class="n">clazz</span><span class="p">,</span> <span class="n">clazz</span><span class="p">(</span><span class="n">error_msg</span><span class="p">),</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">2</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_get_header_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return header value by its name.</span>

<span class="sd">        `headers`:: list of headers</span>
<span class="sd">        `name`:: name of the header</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">next</span><span class="p">(</span>
            <span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">headers</span> <span class="k">if</span> <span class="n">h</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">name</span><span class="p">)),</span>
            <span class="kc">None</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_curl_debug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">debug_type</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This is the implementation of the cURL debug callback.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Exclude all types of debug data that we don&#39;t know how to</span>
        <span class="c1"># handle, as trying to decode and manipulate that data as</span>
        <span class="c1"># strings will likely fail.</span>
        <span class="k">if</span> <span class="n">debug_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__KNOWN_DEBUG_TYPES</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Some versions of PycURL provide the debug data as strings, and</span>
        <span class="c1"># some as arrays of bytes, so we need to check the type of the</span>
        <span class="c1"># provided data and convert it to strings before trying to</span>
        <span class="c1"># manipulate it with the &quot;replace&quot;, &quot;strip&quot; and &quot;split&quot; methods:</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="nb">bytes</span> <span class="k">else</span> <span class="n">data</span>

        <span class="c1"># Split the debug data into lines and send a debug message for</span>
        <span class="c1"># each line:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__DEBUG_PREFIXES</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">debug_type</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">prefix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">line</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>

        </details>

            <div class="docstring"><p>This class is responsible for managing an HTTP connection to the engine
server. It is intended as the entry point for the SDK, and it provides
access to the <code>system</code> service and, from there, to the rest of the
services provided by the API.</p>
</div>


                            <div id="Connection.__init__" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Connection.__init__">#&nbsp;&nbsp</a>

        
            <span class="name">Connection</span><span class="signature">(
    url=None,
    username=None,
    password=None,
    token=None,
    insecure=False,
    ca_file=None,
    debug=False,
    log=None,
    kerberos=False,
    timeout=0,
    compress=True,
    sso_url=None,
    sso_revoke_url=None,
    sso_token_name=&#39;access_token&#39;,
    headers=None,
    pipeline=0,
    connections=0
)</span>
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">username</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">password</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">token</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">insecure</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">ca_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">log</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">kerberos</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">timeout</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">compress</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">sso_url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">sso_revoke_url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">sso_token_name</span><span class="o">=</span><span class="s1">&#39;access_token&#39;</span><span class="p">,</span>
        <span class="n">headers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">pipeline</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">connections</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a new connection to the API server.</span>

<span class="sd">        This method supports the following parameters:</span>

<span class="sd">        `url`:: A string containing the base URL of the server, usually</span>
<span class="sd">        something like `https://server.example.com/ovirt-engine/api`.</span>

<span class="sd">        `username`:: The name of the user, something like `admin@internal`.</span>

<span class="sd">        `password`:: The name password of the user.</span>

<span class="sd">        `token`:: : The token to be used to access API. Optionally, user can</span>
<span class="sd">        use token, instead of username and password to access API. If user</span>
<span class="sd">        don&#39;t specify `token` parameter, SDK will automatically create one.</span>

<span class="sd">        `insecure`:: A boolean flag that indicates if the server TLS</span>
<span class="sd">        certificate and host name should be checked.</span>

<span class="sd">        `ca_file`:: A PEM file containing the trusted CA certificates. The</span>
<span class="sd">        certificate presented by the server will be verified using these CA</span>
<span class="sd">        certificates. If `ca_file` parameter is not set, system wide</span>
<span class="sd">        CA certificate store is used.</span>

<span class="sd">        `debug`:: A boolean flag indicating if debug output should be</span>
<span class="sd">        generated. If the value is `True` and the `log` parameter isn&#39;t</span>
<span class="sd">        `None` then the data sent to and received from the server will</span>
<span class="sd">        be written to the log. Be aware that user names and passwords will</span>
<span class="sd">        also be written, so handle it with care.</span>

<span class="sd">        `log`:: The logger where the log messages will be written.</span>

<span class="sd">        `kerberos`:: A boolean flag indicating if Kerberos</span>
<span class="sd">        authentication should be used instead of the default basic</span>
<span class="sd">        authentication.</span>

<span class="sd">        `timeout`:: The maximum total time to wait for the response, in</span>
<span class="sd">        seconds. A value of zero (the default) means wait for ever. If</span>
<span class="sd">        the timeout expires before the response is received an exception</span>
<span class="sd">        will be raised.</span>

<span class="sd">        `compress`:: A boolean flag indicating if the SDK should ask</span>
<span class="sd">        the server to send compressed responses. The default is `True`.</span>
<span class="sd">        Note that this is a hint for the server, and that it may return</span>
<span class="sd">        uncompressed data even when this parameter is set to `True`.</span>
<span class="sd">        Note that compression will be disabled if user pass `debug`</span>
<span class="sd">        parameter set to `true`, so the debug messages are in plain text.</span>

<span class="sd">        `sso_url`:: A string containing the base SSO URL of the serve.</span>
<span class="sd">        Default SSO url is computed from the `url` if no `sso_url` is provided.</span>

<span class="sd">        `sso_revoke_url`:: A string containing the base URL of the SSO</span>
<span class="sd">        revoke service. This needs to be specified only when using</span>
<span class="sd">        an external authentication service. By default this URL</span>
<span class="sd">        is automatically calculated from the value of the `url` parameter,</span>
<span class="sd">        so that SSO token revoke will be performed using the SSO service</span>
<span class="sd">        that is part of the engine.</span>

<span class="sd">        `sso_token_name`:: The token name in the JSON SSO response returned</span>
<span class="sd">        from the SSO server. Default value is `access_token`.</span>

<span class="sd">        `headers`:: A dictionary with headers which should be send with every</span>
<span class="sd">        request.</span>

<span class="sd">        `connections`:: The maximum number of connections to open to the host.</span>
<span class="sd">        If the value is `0` (the default) then the number of connections will</span>
<span class="sd">        be unlimited.</span>

<span class="sd">        `pipeline`:: The maximum number of request to put in an HTTP pipeline</span>
<span class="sd">        without waiting for the response. If the value is `0` (the default)</span>
<span class="sd">        then pipelining is disabled.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Check mandatory parameters:</span>
        <span class="k">if</span> <span class="n">url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">Error</span><span class="p">(</span><span class="s1">&#39;The </span><span class="se">\&#39;</span><span class="s1">url</span><span class="se">\&#39;</span><span class="s1"> parameter is mandatory&#39;</span><span class="p">)</span>

        <span class="c1"># Check that the CA file exists if insecure is not set:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">insecure</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ca_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">ca_file</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">Error</span><span class="p">(</span><span class="s1">&#39;The CA file </span><span class="se">\&#39;</span><span class="si">%s</span><span class="se">\&#39;</span><span class="s1"> doesn</span><span class="se">\&#39;</span><span class="s1">t exist&#39;</span> <span class="o">%</span> <span class="n">ca_file</span><span class="p">)</span>

        <span class="c1"># Save the URL:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_url</span> <span class="o">=</span> <span class="n">url</span>

        <span class="c1"># Save the logger:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span> <span class="o">=</span> <span class="n">log</span>

        <span class="c1"># Save the credentials:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_username</span> <span class="o">=</span> <span class="n">username</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_password</span> <span class="o">=</span> <span class="n">password</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sso_token</span> <span class="o">=</span> <span class="n">token</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_kerberos</span> <span class="o">=</span> <span class="n">kerberos</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ca_file</span> <span class="o">=</span> <span class="n">ca_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_insecure</span> <span class="o">=</span> <span class="n">insecure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_timeout</span> <span class="o">=</span> <span class="n">timeout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_debug</span> <span class="o">=</span> <span class="n">debug</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_compress</span> <span class="o">=</span> <span class="n">compress</span>

        <span class="c1"># The curl object can be used by several threads, but not</span>
        <span class="c1"># simultaneously, so we need a lock to prevent that:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_curl_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>

        <span class="c1"># Set SSO attributes:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sso_url</span> <span class="o">=</span> <span class="n">sso_url</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sso_revoke_url</span> <span class="o">=</span> <span class="n">sso_revoke_url</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sso_token_name</span> <span class="o">=</span> <span class="n">sso_token_name</span>

        <span class="c1"># Headers:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span> <span class="o">=</span> <span class="n">headers</span> <span class="ow">or</span> <span class="p">{}</span>

        <span class="c1"># Create the curl handle that manages the pool of connections:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_multi</span> <span class="o">=</span> <span class="n">pycurl</span><span class="o">.</span><span class="n">CurlMulti</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_multi</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">M_PIPELINING</span><span class="p">,</span> <span class="nb">bool</span><span class="p">(</span><span class="n">pipeline</span><span class="p">))</span>
        <span class="c1"># Since libcurl 7.30.0:</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">pycurl</span><span class="p">,</span> <span class="s1">&#39;M_MAX_PIPELINE_LENGTH&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_multi</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">M_MAX_PIPELINE_LENGTH</span><span class="p">,</span> <span class="n">pipeline</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_multi</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">M_MAX_HOST_CONNECTIONS</span><span class="p">,</span> <span class="n">connections</span><span class="p">)</span>

        <span class="c1"># Connections:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_curls</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="c1"># Initialize the reference to the system service:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__system_service</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>

        </details>

            <div class="docstring"><p>Creates a new connection to the API server.</p>

<p>This method supports the following parameters:</p>

<p><code><a href="#Connection.url">url</a></code>:: A string containing the base URL of the server, usually
something like <code>https://server.example.com/ovirt-engine/api</code>.</p>

<p><code>username</code>:: The name of the user, something like <code>admin@internal</code>.</p>

<p><code>password</code>:: The name password of the user.</p>

<p><code>token</code>:: : The token to be used to access API. Optionally, user can
use token, instead of username and password to access API. If user
don't specify <code>token</code> parameter, SDK will automatically create one.</p>

<p><code>insecure</code>:: A boolean flag that indicates if the server TLS
certificate and host name should be checked.</p>

<p><code>ca_file</code>:: A PEM file containing the trusted CA certificates. The
certificate presented by the server will be verified using these CA
certificates. If <code>ca_file</code> parameter is not set, system wide
CA certificate store is used.</p>

<p><code>debug</code>:: A boolean flag indicating if debug output should be
generated. If the value is <code>True</code> and the <code>log</code> parameter isn't
<code>None</code> then the data sent to and received from the server will
be written to the log. Be aware that user names and passwords will
also be written, so handle it with care.</p>

<p><code>log</code>:: The logger where the log messages will be written.</p>

<p><code>kerberos</code>:: A boolean flag indicating if Kerberos
authentication should be used instead of the default basic
authentication.</p>

<p><code>timeout</code>:: The maximum total time to wait for the response, in
seconds. A value of zero (the default) means wait for ever. If
the timeout expires before the response is received an exception
will be raised.</p>

<p><code>compress</code>:: A boolean flag indicating if the SDK should ask
the server to send compressed responses. The default is <code>True</code>.
Note that this is a hint for the server, and that it may return
uncompressed data even when this parameter is set to <code>True</code>.
Note that compression will be disabled if user pass <code>debug</code>
parameter set to <code>true</code>, so the debug messages are in plain text.</p>

<p><code>sso_url</code>:: A string containing the base SSO URL of the serve.
Default SSO url is computed from the <code><a href="#Connection.url">url</a></code> if no <code>sso_url</code> is provided.</p>

<p><code>sso_revoke_url</code>:: A string containing the base URL of the SSO
revoke service. This needs to be specified only when using
an external authentication service. By default this URL
is automatically calculated from the value of the <code><a href="#Connection.url">url</a></code> parameter,
so that SSO token revoke will be performed using the SSO service
that is part of the engine.</p>

<p><code>sso_token_name</code>:: The token name in the JSON SSO response returned
from the SSO server. Default value is <code>access_token</code>.</p>

<p><code>headers</code>:: A dictionary with headers which should be send with every
request.</p>

<p><code>connections</code>:: The maximum number of connections to open to the host.
If the value is <code>0</code> (the default) then the number of connections will
be unlimited.</p>

<p><code>pipeline</code>:: The maximum number of request to put in an HTTP pipeline
without waiting for the response. If the value is <code>0</code> (the default)
then pipelining is disabled.</p>
</div>


                            </div>
                            <div id="Connection.send" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Connection.send">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">send</span><span class="signature">(self, request)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">send</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sends an HTTP request and waits for the response.</span>

<span class="sd">        This method is intended for internal use by other components of the</span>
<span class="sd">        SDK. Refrain from using it directly, as backwards compatibility isn&#39;t</span>
<span class="sd">        guaranteed.</span>

<span class="sd">        This method supports the following parameters.</span>

<span class="sd">        `request`:: The Request object containing the details of the HTTP</span>
<span class="sd">        request to send.</span>

<span class="sd">        The returned value is a Request object containing the details of the</span>
<span class="sd">        HTTP response received.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curl_lock</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__send</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Sends an HTTP request and waits for the response.</p>

<p>This method is intended for internal use by other components of the
SDK. Refrain from using it directly, as backwards compatibility isn't
guaranteed.</p>

<p>This method supports the following parameters.</p>

<p><code>request</code>:: The Request object containing the details of the HTTP
request to send.</p>

<p>The returned value is a Request object containing the details of the
HTTP response received.</p>
</div>


                            </div>
                            <div id="Connection.authenticate" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Connection.authenticate">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">authenticate</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">authenticate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return token which can be used for authentication instead of credentials.</span>
<span class="sd">        It will be created, if it not exists, yet. By default the token will be</span>
<span class="sd">        revoked when the connection is closed, unless the `logout` parameter of</span>
<span class="sd">        the `close` method is `False`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sso_token</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sso_token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_access_token</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sso_token</span>
        <span class="k">except</span> <span class="n">pycurl</span><span class="o">.</span><span class="n">error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__parse_error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Return token which can be used for authentication instead of credentials.
It will be created, if it not exists, yet. By default the token will be
revoked when the connection is closed, unless the <code>logout</code> parameter of
the <code><a href="#Connection.close">close</a></code> method is <code>False</code>.</p>
</div>


                            </div>
                            <div id="Connection.wait" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Connection.wait">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">wait</span><span class="signature">(self, context, failed_auth=False)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">wait</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">failed_auth</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curl_lock</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__wait</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">failed_auth</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">pycurl</span><span class="o">.</span><span class="n">error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__parse_error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</pre></div>

        </details>

    

                            </div>
                            <div id="Connection.url" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#Connection.url">#&nbsp;&nbsp</a>

        <span class="name">url</span>
    </div>

            <div class="docstring"><p>Returns a string containing the base URL used by this connection.</p>
</div>


                            </div>
                            <div id="Connection.system_service" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Connection.system_service">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">system_service</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">system_service</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the reference to the root of the services tree.</span>

<span class="sd">        The returned value is an instance of the `SystemService` class.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__system_service</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">ovirtsdk4.services</span> <span class="kn">import</span> <span class="n">SystemService</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__system_service</span> <span class="o">=</span> <span class="n">SystemService</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__system_service</span>
</pre></div>

        </details>

            <div class="docstring"><p>Returns the reference to the root of the services tree.</p>

<p>The returned value is an instance of the <code>SystemService</code> class.</p>
</div>


                            </div>
                            <div id="Connection.service" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Connection.service">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">service</span><span class="signature">(self, path)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">service</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a reference to the service corresponding to the given</span>
<span class="sd">        path. For example, if the `path` parameter is</span>
<span class="sd">        `vms/123/diskattachments` then it will return a reference to</span>
<span class="sd">        the service that manages the disk attachments for the virtual</span>
<span class="sd">        machine with identifier `123`.</span>

<span class="sd">        If there is no service corresponding to the given path an exception</span>
<span class="sd">        will be raised.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">system_service</span><span class="p">()</span><span class="o">.</span><span class="n">service</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Returns a reference to the service corresponding to the given
path. For example, if the <code>path</code> parameter is
<code>vms/123/diskattachments</code> then it will return a reference to
the service that manages the disk attachments for the virtual
machine with identifier <code>123</code>.</p>

<p>If there is no service corresponding to the given path an exception
will be raised.</p>
</div>


                            </div>
                            <div id="Connection.test" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Connection.test">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">test</span><span class="signature">(self, raise_exception=False)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raise_exception</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests the connectivity with the server. If connectivity works</span>
<span class="sd">        correctly it returns `True`. If there is any connectivy problem</span>
<span class="sd">        it will either return `False` or raise an exception if the</span>
<span class="sd">        `raise_exception` parameter is `True`.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">system_service</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="n">Error</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">raise_exception</span><span class="p">:</span>
                <span class="n">six</span><span class="o">.</span><span class="n">reraise</span><span class="p">(</span><span class="o">*</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">())</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">raise_exception</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">Error</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
</pre></div>

        </details>

            <div class="docstring"><p>Tests the connectivity with the server. If connectivity works
correctly it returns <code>True</code>. If there is any connectivy problem
it will either return <code>False</code> or raise an exception if the
<code>raise_exception</code> parameter is <code>True</code>.</p>
</div>


                            </div>
                            <div id="Connection.is_link" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Connection.is_link">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">is_link</span><span class="signature">(self, obj)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">is_link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Indicates if the given object is a link. An object is a link if</span>
<span class="sd">        it has an `href` attribute.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">href</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</pre></div>

        </details>

            <div class="docstring"><p>Indicates if the given object is a link. An object is a link if
it has an <code>href</code> attribute.</p>
</div>


                            </div>
                            <div id="Connection.follow_link" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Connection.follow_link">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">follow_link</span><span class="signature">(self, obj)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">follow_link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Follows the `href` attribute of this object, retrieves the object</span>
<span class="sd">        and returns it.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Check that the &quot;href&quot; attribute has a values, as it is needed</span>
        <span class="c1"># in order to retrieve the representation of the object:</span>
        <span class="n">href</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">href</span>
        <span class="k">if</span> <span class="n">href</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">Error</span><span class="p">(</span>
                <span class="s2">&quot;Can&#39;t follow link because the &#39;href&#39; attribute does&#39;t &quot;</span>
                <span class="s2">&quot;have a value&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Check that the value of the &quot;href&quot; attribute is compatible with the</span>
        <span class="c1"># base URL of the connection:</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_url</span><span class="p">)</span><span class="o">.</span><span class="n">path</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">prefix</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">):</span>
            <span class="n">prefix</span> <span class="o">+=</span> <span class="s1">&#39;/&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">href</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">prefix</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">Error</span><span class="p">(</span>
                <span class="s2">&quot;The URL &#39;</span><span class="si">%s</span><span class="s2">&#39; isn&#39;t compatible with the base URL of the &quot;</span>
                <span class="s2">&quot;connection&quot;</span> <span class="o">%</span> <span class="n">href</span>
            <span class="p">)</span>

        <span class="c1"># Remove the prefix from the URL, follow the path to the relevant</span>
        <span class="c1"># service and invoke the &quot;get&quot;, or &quot;list method to retrieve its representation:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">href</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">):]</span>
        <span class="n">service</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">service</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">List</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">service</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">service</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</pre></div>

        </details>

            <div class="docstring"><p>Follows the <code>href</code> attribute of this object, retrieves the object
and returns it.</p>
</div>


                            </div>
                            <div id="Connection.close" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Connection.close">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">close</span><span class="signature">(self, logout=True)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logout</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Releases the resources used by this connection.</span>

<span class="sd">        `logout`:: A boolean, which specify if token should be revoked,</span>
<span class="sd">        and so user should be logged out.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Revoke access token:</span>
        <span class="k">if</span> <span class="n">logout</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sso_token</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_revoke_access_token</span><span class="p">()</span>

        <span class="c1"># Release resources used by the cURL handle:</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curl_lock</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_multi</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>

        </details>

            <div class="docstring"><p>Releases the resources used by this connection.</p>

<p><code>logout</code>:: A boolean, which specify if token should be revoked,
and so user should be logged out.</p>
</div>


                            </div>
                            <div id="Connection.check_xml_content_type" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Connection.check_xml_content_type">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">check_xml_content_type</span><span class="signature">(self, response)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">check_xml_content_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">         Checks that the content type of the given response is XML. If it is</span>
<span class="sd">         XML then it does nothing. If it isn&#39;t XML then it raises an</span>
<span class="sd">         exception.</span>

<span class="sd">         `response`:: The HTTP response to check.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_content_type</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__XML_CONTENT_TYPE_RE</span><span class="p">,</span>
            <span class="s1">&#39;XML&#39;</span><span class="p">,</span>
            <span class="n">response</span><span class="o">.</span><span class="n">headers</span>
        <span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Checks that the content type of the given response is XML. If it is
XML then it does nothing. If it isn't XML then it raises an
exception.</p>

<p><code>response</code>:: The HTTP response to check.</p>
</div>


                            </div>
                            <div id="Connection.check_json_content_type" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Connection.check_json_content_type">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">check_json_content_type</span><span class="signature">(self, response)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">check_json_content_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">         Checks that the content type of the given response is JSON. If it is</span>
<span class="sd">         JSON then it does nothing. If it isn&#39;t JSON then it raises an</span>
<span class="sd">         exception.</span>

<span class="sd">         `response`:: The HTTP response to check.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_content_type</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__JSON_CONTENT_TYPE_RE</span><span class="p">,</span>
            <span class="s1">&#39;JSON&#39;</span><span class="p">,</span>
            <span class="n">response</span><span class="o">.</span><span class="n">headers</span>
        <span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Checks that the content type of the given response is JSON. If it is
JSON then it does nothing. If it isn't JSON then it raises an
exception.</p>

<p><code>response</code>:: The HTTP response to check.</p>
</div>


                            </div>
                </section>
                <section id="ConnectionBuilder">
                                <div class="attr class">
        <a class="headerlink" href="#ConnectionBuilder">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">ConnectionBuilder</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">ConnectionBuilder</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class is a mechanism to simplify the repeated creation of</span>
<span class="sd">    multiple connections. It stores the connection parameters given</span>
<span class="sd">    in its constructor, and has a single `build` method that is</span>
<span class="sd">    equivalent to calling the constructor of the `Connection`</span>
<span class="sd">    class. Typical use will be like this:</span>

<span class="sd">    [source,python]</span>
<span class="sd">    ----</span>
<span class="sd">    # Create the builder once:</span>
<span class="sd">    builder = ConnectionBuilder(</span>
<span class="sd">        url=&#39;https://enginer40.example.com/ovirt-engine/api&#39;,</span>
<span class="sd">        username=&#39;admin@internal&#39;,</span>
<span class="sd">        password=&#39;redhat123&#39;,</span>
<span class="sd">        ca_file=&#39;ca.pem&#39;,</span>
<span class="sd">    )</span>

<span class="sd">    # Create and use first connection:</span>
<span class="sd">    with builder.build() as connection:</span>
<span class="sd">       ...</span>

<span class="sd">    # Create and use a second connection:</span>
<span class="sd">    with builder.build() as connection:</span>
<span class="sd">       ...</span>
<span class="sd">    ----</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a new connection builder. The parameters are the same</span>
<span class="sd">        accepted by the constructor of the `Connnection` class.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>

    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a new connection using the parameters passed to the</span>
<span class="sd">        constructor, and returns it.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">Connection</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_kwargs</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>This class is a mechanism to simplify the repeated creation of
multiple connections. It stores the connection parameters given
in its constructor, and has a single <code><a href="#ConnectionBuilder.build">build</a></code> method that is
equivalent to calling the constructor of the <code><a href="#Connection">Connection</a></code>
class. Typical use will be like this:</p>

<h2 id="sourcepython">[source,python]</h2>

<h1 id="create-the-builder-once">Create the builder once:</h1>

<p>builder = ConnectionBuilder(
    url='https://enginer40.example.com/ovirt-engine/api',
    username='admin@internal',
    password='redhat123',
    ca_file='ca.pem',
)</p>

<h1 id="create-and-use-first-connection">Create and use first connection:</h1>

<p>with builder.build() as connection:
   ...</p>

<h1 id="create-and-use-a-second-connection">Create and use a second connection:</h1>

<p>with builder.build() as connection:</p>

<h2 id="-1">   ...</h2>
</div>


                            <div id="ConnectionBuilder.__init__" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#ConnectionBuilder.__init__">#&nbsp;&nbsp</a>

        
            <span class="name">ConnectionBuilder</span><span class="signature">(**kwargs)</span>
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a new connection builder. The parameters are the same</span>
<span class="sd">        accepted by the constructor of the `Connnection` class.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>
</pre></div>

        </details>

            <div class="docstring"><p>Creates a new connection builder. The parameters are the same
accepted by the constructor of the <code>Connnection</code> class.</p>
</div>


                            </div>
                            <div id="ConnectionBuilder.build" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#ConnectionBuilder.build">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">build</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a new connection using the parameters passed to the</span>
<span class="sd">        constructor, and returns it.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">Connection</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_kwargs</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Creates a new connection using the parameters passed to the
constructor, and returns it.</p>
</div>


                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.type) {
                    case "function":
                        heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span><span class="signature">${doc.signature}:</span>`;
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value">${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.type}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>